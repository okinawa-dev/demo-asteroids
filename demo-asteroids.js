!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["demo-asteroids"]=t():e["demo-asteroids"]=t()}(self,(function(){return(()=>{var e={375:(e,t,n)=>{var i;self,e.exports=(()=>{"use strict";var r={d:(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};r.r(o),r.d(o,{Background:()=>Ye,Clock:()=>I,Core:()=>g,Device:()=>m,Effects:()=>E,Emitter:()=>Be,Fonts:()=>j,GUI:()=>a,INPUT:()=>s,Item:()=>A,Localization:()=>F,Logs:()=>Se,MATH:()=>c,Options:()=>l,Particles:()=>_,Player:()=>Pe,Preloader:()=>ke,Scene:()=>pe,Sounds:()=>z,Sprites:()=>T,engine:()=>xe,init:()=>qe});var s={};r.r(s),r.d(s,{COMBO_TYPES:()=>v,Controller:()=>y,KEYS:()=>d,Receiver:()=>p});var a={};r.r(a),r.d(a,{ALIGN:()=>oe,EVENTS:()=>re,GuiConsole:()=>ne,GuiElement:()=>U,GuiText:()=>Q,ORDENATION:()=>ie});var c={};r.r(c),r.d(c,{Point:()=>u,Rotation:()=>b,angleToDirectionVector:()=>Ee,pointDistance:()=>Re});var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.useAnimationFrame=!1,this.useSmoothParticles=!1,this.drawBoundingBoxes=!1,this.drawMaxRadius=!1,this.drawCollisionRadius=!1,this.drawOrigins=!1,this.drawCenters=!1,this.drawTrackers=!1,this.drawDirectionVectors=!1,this.showFps=!1,this.showStatistics=!1,this.showResizeMessage=!0,this.outputPressedKeys=!1,this.outputPressedCombos=!1,this.outputClicks=!1,this.debugInConsole=!1,this.debugInHtml=!1,this.debugFunctionNames=!1,this.allowPause=!0,this.allowHalt=!1,this.allowFForFps=!0,this.pauseOnWindowChange=!1,this.avoidLeavingPage=!1,this.preventDefaultKeyStrokes=!0,this.useLanguageScreen=!1,this.defaultLanguage="english",this.assetsURLPrefix=null}var t,n;return t=e,(n=[{key:"addOptions",value:function(e){for(var t in e)this[t]=e[t]}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=void 0===t?0:t,this.y=void 0===n?0:n}var t,n;return t=e,(n=[{key:"magnitude",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"normalize",value:function(){var t=this.magnitude();return new e(this.x/t,this.y/t)}},{key:"equals",value:function(t){return t instanceof e!=0&&this.x==t.x&&this.y==t.y}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function f(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function h(){var e="";return window.location.href?window.location.href:("file:"!=window.location.protocol&&(e+=window.location.protocol+"//"),""!==window.location.host&&(e+=window.location.host+"/"),e)}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inverseKeyboard={},this.pressed={},this.lastPressed=[],this.lastPressedTime=(new Date).getTime(),this.currentInputController=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(this.inverseKeyboard[d[e]]=e);f("keyup",document,(function(e){xe.input.onKeyup(e)})),f("keydown",document,(function(e){xe.input.onKeydown(e),xe.input.isTargetInput(e)||!0!==xe.options.preventDefaultKeyStrokes&&8!=e.keyCode&&46!=e.keyCode||e.preventDefault()})),f("blur",window,(function(){xe.input.resetKeys(),xe.options.pauseOnWindowChange&&xe.pauseGame()})),f("touchstart",xe.core.canvas,(function(e){return xe.input.onClickStart(e.touches[0].clientX,e.touches[0].clientY),navigator.userAgent.match(/Android/i)&&e.preventDefault(),!1})),f("touchmove",xe.core.canvas,(function(e){return e.preventDefault(),!1})),f("touchend",xe.core.canvas,(function(e){return e.preventDefault(),!1})),f("click",xe.core.canvas,(function(e){return xe.input.onClickStart(e.clientX,e.clientY),e.preventDefault(),!1})),f("mousedown",xe.core.canvas,(function(e){return e.preventDefault(),!1}))}},{key:"activate",value:function(){}},{key:"getCurrentInputcontroller",value:function(){return this.currentInputController}},{key:"setCurrentInputController",value:function(e){this.currentInputController=e}},{key:"isKeyPressed",value:function(e){return this.pressed[e]}},{key:"onKeydown",value:function(e){!0!==this.pressed[e.keyCode]&&(this.pressed[e.keyCode]=!0,this.addLastPressed(e.keyCode))}},{key:"onKeyup",value:function(e){delete this.pressed[e.keyCode]}},{key:"onClickStart",value:function(e,t){if(!0!==xe.device.isResizing){var n=new u(e,t),i=xe.device.getGlobalScroll();n.x+=i.x,n.y+=i.y,n.x<xe.device.canvasGlobalOffset.x||n.y<xe.device.canvasGlobalOffset.y||n.x>xe.device.canvasGlobalOffset.x+xe.core.canvas.width||n.y>xe.device.canvasGlobalOffset.y+xe.core.canvas.height||(n.x-=xe.device.canvasGlobalOffset.x,n.y-=xe.device.canvasGlobalOffset.y,this.currentInputController.detectClick(n))}}},{key:"resetKeys",value:function(){for(var e in this.pressed)this.pressed[e]=!1}},{key:"addLastPressed",value:function(e){this.currentInputController.informKeyPressed(e);var t=(new Date).getTime();t-this.lastPressedTime>1e3&&(this.lastPressed=[]),this.lastPressedTime=t,this.lastPressed.push(e),this.lastPressed.length>10&&this.lastPressed.shift(),!0===xe.options.outputPressedKeys&&xe.logs.log("Input.addLastPressed","Pressed key: "+this.inverseKeyboard[e],t);var n=this.currentInputController.detectCombo();null!==n&&this.currentInputController.informComboPerformed(n,t)}},{key:"addClick",value:function(e){this.currentInputController.informClick(e),!0===xe.options.outputClicks&&xe.logs.log("Input.addClick","Click over: "+e)}},{key:"getKeyFromCode",value:function(e){return this.inverseKeyboard[e]}},{key:"convertKeyToNumber",value:function(e){switch(e){case d.NINE:return 9;case d.EIGTH:return 8;case d.SEVEN:return 7;case d.SIX:return 6;case d.FIVE:return 5;case d.FOUR:return 4;case d.THREE:return 3;case d.TWO:return 2;case d.ONE:return 1;case d.ZERO:return 0}return-1}},{key:"convertNumberToKey",value:function(e){switch(e){case 9:return d.NINE;case 8:return d.EIGTH;case 7:return d.SEVEN;case 6:return d.SIX;case 5:return d.FIVE;case 4:return d.FOUR;case 3:return d.THREE;case 2:return d.TWO;case 1:return d.ONE;case 0:return d.ZERO}return d.ZERO}},{key:"isTargetInput",value:function(e){return"textarea"==e.target.type||"text"==e.target.type||"number"==e.target.type||"email"==e.target.type||"password"==e.target.type||"search"==e.target.type||"tel"==e.target.type||"url"==e.target.type||e.target.isContentEditable}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.combos={},this.comboListeners={},this.keyListeners={},this.clickableZones={},this.clickListeners=[]}var t,n;return t=e,(n=[{key:"initialize",value:function(){}},{key:"activate",value:function(){xe.input.setCurrentInputController(this),this.addKeyListener(xe.core,"eventKeyPressed",[d.P,d.ESC,d.F],!0)}},{key:"addKeyListener",value:function(e,t,n,i){void 0===i&&(i=!1);var r={};r.listeningOb=e,r.listeningFunc=t,r.onPause=i;for(var o=0,s=n.length;o<s;o++)void 0===this.keyListeners[n[o]]?this.keyListeners[n[o]]=[r]:this.keyListeners[n[o]].push(r)}},{key:"addClickListener",value:function(e,t,n){void 0===n&&(n=!1);var i={};i.listeningOb=e,i.listeningFunc=t,i.onPause=n,this.clickListeners.push(i)}},{key:"removeListeners",value:function(e){var t,n,i,r;for(t in this.keyListeners)for(n=0,r=this.keyListeners[t].length;n<r;n++)this.keyListeners[t][n].listeningOb==e&&(this.keyListeners[t].splice(n,1),this.keyListeners[t].length||delete this.keyListeners[t]);for(t=0,i=this.clickListeners.length;t<i;t++)for(n=0,r=this.clickListeners[t].length;n<r;n++)this.clickListeners[t][n].listeningOb==e&&this.clickListeners[t].splice(n,1)}},{key:"informKeyPressed",value:function(e){var t=[];if(void 0!==this.keyListeners[e]&&(t=t.concat(this.keyListeners[e])),void 0!==this.keyListeners[d.ANY_KEY]&&(t=t.concat(this.keyListeners[d.ANY_KEY])),void 0!==t)for(var n=0,i=t.length;n<i;n++){var r=t[n];!r.onPause&&xe.paused||void 0!==r.listeningOb[r.listeningFunc]&&r.listeningOb[r.listeningFunc](e)}}},{key:"informClick",value:function(e){if(void 0!==this.clickListeners)for(var t=0,n=this.clickListeners.length;t<n;t++){var i=this.clickListeners[t];!i.onPause&&xe.paused||void 0!==i.listeningOb[i.listeningFunc]&&i.listeningOb[i.listeningFunc](e)}}},{key:"defineCombo",value:function(e,t,n){this.combos[e]={comboType:t,comboKeys:n,lastTime:0}}},{key:"addComboListener",value:function(e,t,n,i){void 0===i&&(i=!1);var r=[];r.listeningOb=e,r.listeningFunc=t,r.onPause=i;for(var o=0,s=n.length;o<s;o++)void 0===this.comboListeners[n[o]]?this.comboListeners[n[o]]=[r]:this.comboListeners[n[o]].push(r)}},{key:"informComboPerformed",value:function(e,t){!0===xe.options.outputPressedCombos&&xe.logs.log("Input.informComboPerformed","Combo activated: "+e,t),this.combos[e].lastTime=t;var n=this.comboListeners[e];if(void 0!==n)for(var i=0,r=n.length;i<r;i++){var o=n[i];!o.onPause&&xe.paused||void 0!==o.listeningOb[o.listeningFunc]&&o.listeningOb[o.listeningFunc](e)}}},{key:"detectCombo",value:function(){for(var e in this.combos){var t=this.combos[e],n=void 0,i=void 0;if(t.comboType==v.SIMULTANEOUS){for(n=0,i=t.comboKeys.length;n<i&&xe.input.isKeyPressed(t.comboKeys[n]);n++)if(n==i-1&&xe.input.isKeyPressed(t.comboKeys[n]))return e}else if(t.comboType==v.CONSECUTIVE){var r=xe.input.lastPressed.length,o=t.comboKeys.length;if(r<o)return null;for(n=1;n<=o&&n<=r&&t.comboKeys[o-n]==xe.input.lastPressed[r-n];n++)if(n>=o||n>=r)return e}}return null}},{key:"addClickZone",value:function(e,t,n,i){this.clickableZones[e]={position:t,size:n,character:i}}},{key:"detectClick",value:function(e){for(var t in this.clickableZones){var n=this.clickableZones[t];e.x>=n.position.x-n.size.x/2&&e.x<=n.position.x+n.size.x/2&&e.y>=n.position.y-n.size.y/2&&e.y<=n.position.y+n.size.y/2&&(null!==n.character&&xe.input.addLastPressed(n.character),xe.input.addClick(t))}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),d={ANY_KEY:-1,INSERT:45,DELETE:46,SPACEBAR:32,ESC:27,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222,NTILDE:209},v={CONSECUTIVE:1,SIMULTANEOUS:2};var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.FRAMES_PER_SECOND=60,this.TIME_PER_FRAME=1e3/this.FRAMES_PER_SECOND,this.paused=!1,this.halted=!1,this.canvas=null,this.ctx=null,this.size=new u(500,500),this.useAnimationFrame=!1,this.timeLastRender=(new Date).getTime(),this.timeGameStart=(new Date).getTime(),this.fpsPassed=0,this.fps=this.FRAMES_PER_SECOND}var t,n;return t=e,(n=[{key:"initialize",value:function(e){return xe.logs.log("Engine::Core.initialize","Initializing engine core object"),this.canvas=document.getElementById(e),this.size.x=this.canvas.width,this.size.y=this.canvas.height,this.timeLastRender=(new Date).getMilliseconds(),this.ctx=this.canvas.getContext&&this.canvas.getContext("2d"),this.ctx?(xe.logs.log("Engine::Core.initialize","UserAgent: "+xe.device.getUserAgent()),!1===xe.options.useAnimationFrame||null===window.requestAnimationFrame?(this.useAnimationFrame=!1,xe.logs.log("Engine::Core.initialize","NOT using requestAnimationFrame")):(this.useAnimationFrame=!0,xe.logs.log("Engine::Core.initialize","Modern browser, using requestAnimationFrame")),this.loop(),1):(xe.logs.log("Engine::Core.initialize","Old browser, unable to create canvas context"),alert("Unable to get canvas context. Old browser?"),null)}},{key:"activate",value:function(){xe.logs.log("Engine::activate","Starting engine"),xe.game.activate(),xe.scenes.advanceScene()}},{key:"eventKeyPressed",value:function(e){e==d.P&&!0===xe.options.allowPause?this.paused?this.unpauseGame():!1!==xe.scenes.getCurrentScene().playable&&this.pauseGame():e==d.ESC&&!0===xe.options.allowHalt?this.halted?(this.halted=!1,xe.logs.log("Engine::eventKeyPressed","Engine un-halted"),this.timeLastRender=(new Date).getTime(),this.loop()):(this.halted=!0,xe.logs.log("Engine::eventKeyPressed","Engine halted"),xe.scenes.getCurrentScene().gui.get("console").addText("halt","Engine halted"),xe.scenes.getCurrentScene().gui.draw(this.ctx)):e!=d.F||!0!==xe.options.allowFForFps||this.paused||this.halted||(!0===xe.options.showFps?xe.options.showFps=!1:xe.options.showFps=!0)}},{key:"loop",value:function(){var e=(new Date).getTime(),t=e-this.timeLastRender;if(t>=xe.core.TIME_PER_FRAME){this.timeLastRender=e;var n=xe.scenes.getCurrentScene();if(this.halted)return;n&&!0===n.isCurrent&&(!1===this.paused&&(n.step(t),void 0!==xe.game&&xe.game.step(t),xe.effects.step(t),xe.particles.step(t)),xe.clock.step(t),xe.player.step(t),n.draw(this.ctx),xe.effects.draw(this.ctx),xe.particles.draw(this.ctx),this.fpsPassed++,!0===xe.options.showStatistics&&(n.getAttachedItems().length>0&&n.gui.get("console").addText("numItems",n.getAttachedItems().length+" "+xe.localization.get("items")),xe.effects.effects.length>0&&n.gui.get("console").addText("numEffects",xe.effects.effects.length+" "+xe.localization.get("effects")),xe.particles.particles.length>0&&n.gui.get("console").addText("numParticles",xe.particles.particles.length+" "+xe.localization.get("particles")))),t=0}!0===this.useAnimationFrame?window.requestAnimationFrame((function(){xe.core.loop()})):setTimeout((function(){xe.core.loop()}),xe.core.TIME_PER_FRAME-t)}},{key:"clearScreen",value:function(){this.ctx.clearRect(0,0,this.size.x,this.size.y)}},{key:"pauseGame",value:function(){!1!==xe.options.allowPause&&(this.paused=!0,xe.scenes.getCurrentScene().pauseGame())}},{key:"unpauseGame",value:function(){!1!==xe.options.allowPause&&(this.paused=!1,xe.scenes.getCurrentScene().unpauseGame())}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvasGlobalOffset=new u,this.isTouchDevice=!1,this.isResizing=!1,this._clearTimeOutId=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){var e=this;this.isTouchDevice=this.detectTouchDevice(),this.isTouchDevice?xe.logs.log("Engine::Initialize","Touch device detected"):xe.logs.log("Engine::Initialize","Touch device NOT detected"),this.canvasGlobalOffset=xe.device.getGlobalOffset(xe.core.canvas),f("resize",window,(function(){xe.device.isResizing=!0,!0===xe.options.showResizeMessage&&xe.gui.get("console").addText("resize","Resizing!"),xe.device.canvasGlobalOffset=xe.device.getGlobalOffset(xe.core.canvas),clearTimeout(e._clearTimeOutId),e._clearTimeOutId=setTimeout(xe.device.doneResizing,1e3)})),!0===xe.options.avoidLeavingPage&&this.avoidLeavingPage()}},{key:"doneResizing",value:function(){xe.device.isResizing=!1,!0===xe.options.showResizeMessage&&xe.gui.get("console").addText("resize","Resizing done")}},{key:"activate",value:function(){}},{key:"getGlobalScroll",value:function(){var e=new u(0,0);if(window.pageYOffset)e.x=window.pageXOffset,e.y=window.pageYOffset;else{var t=document.getElementsByTagName("html")[0];t.scrollTop&&(e.x=t.scrollLeft,e.y=t.scrollTop)}return e}},{key:"getGlobalOffset",value:function(e){var t=new u(0,0);for(t.x=e.offsetLeft,t.y=e.offsetTop;e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}},{key:"detectTouchDevice",value:function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}},{key:"getUserAgent",value:function(){return navigator.userAgent}},{key:"avoidLeavingPage",value:function(){window.onbeforeunload=function(){return""}}},{key:"createAndDownloadFile",value:function(e,t){if(window.navigator.msSaveOrOpenBlob){var n=new Blob([t],{type:"text/csv;charset=utf-8;"});window.navigator.msSaveOrOpenBlob(n,e)}else{var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download",e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}},{key:"detectIE",value:function(){var e=navigator.userAgent.toLowerCase();return/msie/.test(e)?parseFloat((e.match(/.*(?:rv|ie)[/: ](.+?)([ );]|$)/)||[])[1]):navigator.appVersion.indexOf("Trident/")>0?11:-1}},{key:"isIE",value:function(){return-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var b=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.angle=0,this.a=1,this.b=0,this.c=0,this.d=1}var t,n;return t=e,(n=[{key:"getAngle",value:function(){return this.angle}},{key:"rotate",value:function(e){this.update(this.angle+e)}},{key:"update",value:function(e){this.angle=e,this.a=Math.cos(this.angle),this.b=-Math.sin(this.angle),this.c=Math.sin(this.angle),this.d=Math.cos(this.angle)}},{key:"transformPosition",value:function(e){return new u(e.x*this.a+e.y*this.b,e.x*this.c+e.y*this.d)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var A=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.spriteName=null,this._visible=!0,this.position=new u,this.size=new u,this.scaling=new u(1,1),this.speed=new u,this.maxVel=0,this.accel=0,this.vRot=0,this.maxVRot=0,this.accelRot=0,this.rotation=new b,this.globalAlpha=1,this.maxRadius=0,this.collisionRadius=0,this.isAnimated=!1,this.currentFrame=0,this.numLoops=1,this.forceFrameSpeed=0,this.timeLastFrame=0,this._attachedItems=[],this._removedItems=[],this._parent=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){}},{key:"activate",value:function(){for(var e=0,t=this._attachedItems.length;e<t;e++)this._attachedItems[e].activate()}},{key:"getVisible",value:function(){return this._visible}},{key:"setVisible",value:function(e){this._visible=e}},{key:"getParent",value:function(){return this._parent}},{key:"setParent",value:function(e){this._parent=e}},{key:"getParentScene",value:function(){for(var e=this;null!==e.getParent();)e=e.getParent();return e===this?xe.scenes.getCurrentScene():e}},{key:"getAttachedItems",value:function(){return this._attachedItems}},{key:"attachItem",value:function(e){this._attachedItems.push(e),e.setParent(this)}},{key:"detachItem",value:function(e){var t=this.getParentScene();t.input.removeListeners(e);for(var n=e.children(),i=0,r=n.length;i<r;i++)t.input.removeListeners(n[i]);this._removedItems.push(e),e.setParent(null)}},{key:"detachAllItems",value:function(){for(var e=0,t=this._attachedItems.length;e<t;e++){var n=this._attachedItems[e];n.detachAllItems(),this.detachItem(n)}this._finalizeRemoved()}},{key:"children",value:function(){for(var e=[],t=0,n=this._attachedItems.length;t<n;t++)e=(e=e.concat(this._attachedItems[t])).concat(this._attachedItems[t].children());return e}},{key:"_resetItems",value:function(){this._attachedItems.length=0}},{key:"_resetRemoved",value:function(){this._removedItems.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this._removedItems.length;e<t;e++){var n=this._removedItems[e],i=this._attachedItems.indexOf(n);-1!=i&&this._attachedItems.splice(i,1)}this._resetRemoved()}},{key:"setImage",value:function(e){this.spriteName=e,this.size=xe.sprites.getSpriteSize(e)}},{key:"getOrigin",value:function(){var e=this.getPosition();return new u(e.x-this.size.x/2,e.y-this.size.y/2)}},{key:"getPosition",value:function(){var e=new u,t=new u,n=new u;return null!==this._parent?(t=this._parent.getPosition(),n=this._parent.rotation.transformPosition(this.position),e.x=n.x+t.x,e.y=n.y+t.y):(e.x=this.position.x,e.y=this.position.y),e}},{key:"setPosition",value:function(e,t){this.position.x=e,this.position.y=t}},{key:"getSize",value:function(){return this.size}},{key:"setSize",value:function(e,t){this.size.x=e,this.size.y=t}},{key:"getScaling",value:function(){return this.scaling}},{key:"setScaling",value:function(e,t){this.scaling.x=e,this.scaling.y=t}},{key:"getSpeed",value:function(){return this.speed}},{key:"setSpeed",value:function(e,t){this.speed.x=e,this.speed.y=t}},{key:"getParentPosition",value:function(){return null!==this._parent?this._parent.getPosition():new u}},{key:"getParentSpeed",value:function(){return null!==this._parent?this._parent.getSpeed():new u}},{key:"getRadius",value:function(){return Math.sqrt(Math.pow(this.size.x/2,2)+Math.pow(this.size.y/2,2))}},{key:"getMagnitude",value:function(){return Math.sqrt(this.speed.x*this.speed.x+this.speed.y*this.speed.y)}},{key:"move",value:function(e,t){this.position.x+=e,this.position.y+=t}},{key:"rotate",value:function(e){this.rotation.rotate(e)}},{key:"setRotation",value:function(e){this.rotation.update(e)}},{key:"getRotation",value:function(){return null!==this._parent?this.rotation.getAngle()+this._parent.getRotation():this.rotation.getAngle()}},{key:"draw",value:function(e){if(!0===this._visible){for(var t=0,n=this._attachedItems.length;t<n;t++)this._attachedItems[t].draw(e);null!==this.spriteName&&xe.sprites.draw(e,this),!0===xe.options.drawBoundingBoxes&&this.drawHelper(e,"spriteBox"),!0===xe.options.drawMaxRadius&&this.drawHelper(e,"maxRadius"),!0===xe.options.drawCollisionRadius&&this.drawHelper(e,"collisionRadius"),!0===xe.options.drawOrigins&&this.drawHelper(e,"origin"),!0===xe.options.drawCenters&&this.drawHelper(e,"center"),!0===xe.options.drawDirectionVectors&&this.drawHelper(e,"direction")}}},{key:"step",value:function(e){0===this.speed.x&&0===this.speed.y||this.move(this.speed.x*e/xe.core.TIME_PER_FRAME,this.speed.y*e/xe.core.TIME_PER_FRAME),0!==this.vRot&&this.rotate(this.vRot*e/xe.core.TIME_PER_FRAME),!0===this.isAnimated&&null!==this.spriteName&&xe.sprites.step(e,this);for(var t=0,n=this._attachedItems.length;t<n;t++)this._attachedItems[t].step(e);this._finalizeRemoved()}},{key:"eventAnimationRestart",value:function(){}},{key:"drawHelper",value:function(e,t){var n=this.getPosition(),i=this.getSize(),r=this.getScaling();if("maxRadius"==t)e.beginPath(),e.arc(n.x,n.y,this.maxRadius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=1,e.strokeStyle="#FF0000",e.stroke();else if("collisionRadius"==t)e.beginPath(),e.arc(n.x,n.y,this.collisionRadius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=1,e.strokeStyle="#FF0000",e.stroke();else if("origin"==t)e.fillStyle="#FF0000",e.fillRect(n.x-i.x/2*r.x,n.y-i.y/2*r.y,2,2);else if("center"==t)e.fillStyle="#FF0000",e.fillRect(n.x,n.y,2,2);else if("spriteBox"==t)e.lineWidth=1,e.strokeStyle="#FF0000",e.strokeRect(n.x-i.x/2*r.x,n.y-i.y/2*r.y,i.x*r.x,i.y*r.y);else if("direction"==t){var o=this.getSpeed();e.lineWidth=1,e.strokeStyle="#FF0000",e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(n.x+10*o.x,n.y+10*o.y),e.stroke()}}},{key:"collide",value:function(){return this.detachAllItems(),!0}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=k(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function k(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&P(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=S(i);if(r){var n=S(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return x(this,e)});function s(e,t,n,i,r){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a=o.call(this);var c=xe.sprites.sprites[e];return a.size=new u(c[3],c[4]),a.numFrames=c[5],a.position=new u(t,n),a.speed=new u(i,r),a.lived=0,a.lifeTime=0,a.maxLoops=1,a.spriteName=e,a.initialScaling=1,a.finalScaling=1,a.transparencyMethod=0,a.globalAlpha=1,a}return t=s,(n=[{key:"step",value:function(e){O(S(s.prototype),"step",this).call(this,e),this.lived++;var t=1;1==this.initialScaling&&1==this.finalScaling||(t=this.initialScaling+(this.finalScaling-this.initialScaling)*this.lived/this.lifeTime,this.scaling.x=t,this.scaling.y=t),2==this.transparencyMethod?0!==this.lifeTime?this.globalAlpha=1-this.lived/this.lifeTime:this.globalAlpha=1-this.currentFrame/this.numFrames:1==this.transparencyMethod&&(0!==this.lifeTime?this.globalAlpha=this.lived/this.lifeTime:this.globalAlpha=this.currentFrame/this.numFrames),!0===this.isAnimated&&xe.sprites.step(e,this)}},{key:"draw",value:function(e){O(S(s.prototype),"draw",this).call(this,e)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(A);var E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.effects=[],this.removed=[]}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.effects.length=0}},{key:"removeEffect",value:function(e){this.removed.push(e)}},{key:"_resetRemoved",value:function(){this.removed.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this.removed.length;e<t;e++){var n=this.effects.indexOf(this.removed[e]);-1!=n&&this.effects.splice(n,1)}}},{key:"step",value:function(e){this._resetRemoved();for(var t=0,n=this.effects.length;t<n;t++){var i=this.effects[t];i.step(e),i.lifeTime>0&&i.lived>i.lifeTime&&this.removeEffect(i),i.maxLoops>0&&i.numLoops>i.maxLoops&&this.removeEffect(i)}this._finalizeRemoved()}},{key:"draw",value:function(e){for(var t=0,n=this.effects.length;t<n;t++)this.effects[t].draw(e)}},{key:"addEffect",value:function(e,t,n,i,r){var o=new R(e,t,n,i,r);return this.effects.push(o),o}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.particles=[],this.maxParticles=1e4,this._removedParticles=[],this.effectField=document.createElement("canvas"),this.effectField.width=xe.core.size.x,this.effectField.height=xe.core.size.y,this.effectField.ctx=this.effectField.getContext("2d")}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.particles=[],this.maxParticles=1e4,this._removedParticles=[]}},{key:"addParticle",value:function(e){this.particles.length>this.maxParticles||this.particles.push(e)}},{key:"removeParticle",value:function(e){this._removedParticles.push(e)}},{key:"_resetItems",value:function(){this.particles.length=0}},{key:"_resetRemoved",value:function(){this._removedParticles.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this._removedParticles.length;e<t;e++){var n=this._removedParticles[e],i=this.particles.indexOf(n);-1!=i&&this.particles.splice(i,1)}}},{key:"step",value:function(e){var t,n,i=this.particles.length;for(t=0;t<i;t++)(n=this.particles[t]).lived>n.ttl?this.removeParticle(n):n.step(e);this._finalizeRemoved()}},{key:"draw",value:function(e){if(this.particles.length>0){this.effectField.ctx.clearRect(0,0,xe.core.size.x,xe.core.size.y);for(var t,n=-1;t=this.particles[++n];){var i=[t.color[0]-3*t.lived,t.color[1]-t.lived,t.color[2],t.color[3]];this.effectField.ctx.fillStyle="rgba("+i.join(",")+")",this.effectField.ctx.fillRect(t.position.x,t.position.y,t.size,t.size)}e.drawImage(this.effectField,0,0,xe.core.size.x,xe.core.size.y)}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var T=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sprites={},this.images={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.sprites.length=0,this.images.length=0}},{key:"step",value:function(e,t){var n=this.sprites[t.spriteName][7],i=this.sprites[t.spriteName][5],r=this.sprites[t.spriteName][6];if(0!==t.forceFrameSpeed&&(n=t.forceFrameSpeed),i>1){var o=(new Date).getTime();if(0===t.timeLastFrame&&(t.timeLastFrame=o),o-t.timeLastFrame>1e3/n){var s=t.currentFrame;t.currentFrame++,t.currentFrame>=r+i&&(t.currentFrame=r),t.timeLastFrame=o,s==i-1&&(t.numLoops+=1,void 0!==t.eventAnimationRestart&&t.eventAnimationRestart())}}}},{key:"draw",value:function(e,t){if(!1!==t.getVisible()){var n=this.sprites[t.spriteName][0],i=this.sprites[t.spriteName][1],r=this.sprites[t.spriteName][2],o=this.sprites[t.spriteName][3],s=this.sprites[t.spriteName][4],a=t.getPosition();e.globalAlpha=t.globalAlpha,0!==t.rotation.getAngle()?(e.save(),e.translate(a.x,a.y),e.rotate(t.rotation.getAngle()),e.drawImage(this.images[n],i+t.currentFrame*o,r,o,s,-o/2*t.scaling.x,-s/2*t.scaling.y,o*t.scaling.x,s*t.scaling.y),e.restore()):e.drawImage(this.images[n],i+t.currentFrame*o,r,o,s,a.x-o/2*t.scaling.x,a.y-s/2*t.scaling.y,o*t.scaling.x,s*t.scaling.y),e.globalAlpha=1}}},{key:"imageExists",value:function(e){return Object.prototype.hasOwnProperty.call(this.images,e)}},{key:"spriteExists",value:function(e){return Object.prototype.hasOwnProperty.call(this.sprites,e)}},{key:"addImage",value:function(e,t){this.images[e]=t}},{key:"addSprite",value:function(e,t,n,i,r,o,s,a,c){this.sprites[e]=[t,n,i,r,o,s,a,c]}},{key:"getImage",value:function(e){return this.images[this.sprites[e][0]]}},{key:"getImageFromPath",value:function(e){return this.images[e]}},{key:"getSpriteData",value:function(e){var t=this.sprites[e];return void 0!==t?t:null}},{key:"getSpriteInfo",value:function(e,t){var n=this.sprites[e];if(void 0!==n){var i=n[t];if(void 0!==i)return i}return null}},{key:"getSpriteSize",value:function(e){var t=this.sprites[e],n=0,i=0;return void 0!==t&&(n=t[3],i=t[4]),new u(n,i)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sounds={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.sounds.length=0}},{key:"step",value:function(){}},{key:"soundExists",value:function(e){for(var t=Object.keys(this.sounds),n=0,i=t.length;n<i;n++)if(this.sounds[t[n]][1]==e)return!0;return!1}},{key:"addSound",value:function(e,t,n){this.sounds[e]=[n,t]}},{key:"get",value:function(e){if(void 0===this.sounds[e])return null;var t=this.sounds[e][0];return t.currentTime>0&&(t=t.cloneNode()),t}},{key:"play",value:function(e){var t=this.get(e);null!==t&&(t.currentTime>0&&(t.currentTime=0),t.play())}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fonts={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.fonts.length=0}},{key:"step",value:function(){}},{key:"fontExists",value:function(e){for(var t=Object.keys(this.fonts),n=0,i=t.length;n<i;n++)if(this.fonts[t[n]][1]==e)return!0;return!1}},{key:"addFont",value:function(e,t,n){this.fonts[e]=[n,t]}},{key:"get",value:function(e){return void 0===this.fonts[e]?null:this.fonts[e][0]}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var C=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collection=null,this.currentSceneIndex=null,this.currentSceneName=null,this.currentScene=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.collection=[],this.currentSceneIndex=0,this.currentSceneName="",this.currentScene=null}},{key:"activate",value:function(){}},{key:"draw",value:function(){}},{key:"step",value:function(){}},{key:"getCurrentScene",value:function(){return this.currentScene}},{key:"setScene",value:function(e){void 0!==this.currentScene&&null!==this.currentScene&&(this.currentScene.isCurrent=!1),xe.core.clearScreen(),this.currentSceneIndex=e,this.currentSceneName=xe.scenes.collection[e].name,this.currentScene=xe.scenes.collection[e].scene,this.currentScene.isCurrent=!0,this.currentScene.activate(),void 0!==xe.player&&null!==xe.player&&xe.player.activate(),xe.logs.log("Scenes::setScene","Set Scene: "+this.currentSceneName+" ("+this.currentSceneIndex+")"),xe.external("SCENE_CHANGE",null,null)}},{key:"addScene",value:function(e,t){xe.logs.log("Scenes::addScene","Add Scene: "+t),e.isCurrent=!1,this.collection.push({scene:e,name:t})}},{key:"insertScene",value:function(e,t,n){e.isCurrent=!1,this.collection.splice(n,0,{scene:e,name:t})}},{key:"advanceScene",value:function(){xe.scenes.currentSceneIndex+1>=xe.scenes.collection.length||xe.scenes.setScene(xe.scenes.currentSceneIndex+1)}},{key:"goBackScene",value:function(){this.currentSceneIndex-1<0||this.setScene(this.currentSceneIndex-1)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.startTime=0,this.passedTime=0,this.ticker500=0,this.listeners500={},this.ticker1=0,this.listeners1={},this.ticker5=0,this.listeners5={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.startTime=(new Date).getTime()}},{key:"activate",value:function(){}},{key:"step",value:function(e){this.ticker1+=e,this.ticker5+=e,this.ticker500+=e,this.ticker1>=1e3&&(this.informListeners(this.listeners1),this.ticker1=0),this.ticker5>=5e3&&(this.informListeners(this.listeners5),this.ticker5=0),this.ticker500>=500&&(this.informListeners(this.listeners500),this.ticker500=0)}},{key:"draw",value:function(){}},{key:"suscribe500",value:function(e,t){this.listeners500[e]=t}},{key:"suscribeOneSecond",value:function(e,t){this.listeners1[e]=t}},{key:"suscribeFiveSeconds",value:function(e,t){this.listeners5[e]=t}},{key:"informListeners",value:function(e){for(var t in e)e[t]()}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var F=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fallbackLanguage="english",this.selectedLanguage="",this.stringTables={},this.baseTexts={english:{paused:"Paused, press P to continue",loaded:"Loading",items:"items",effects:"effects",particles:"particles",choose_language:"Choose language",english:"English",spanish:"Spanish"},spanish:{paused:"Pausa, pulsa P para continuar",loaded:"Cargando",items:"elementos",effects:"efectos",particles:"partículas",choose_language:"Escoge el idioma",english:"English",spanish:"Español"}}}var t,n;return t=e,(n=[{key:"initialize",value:function(){for(var e in this.selectedLanguage="english",this.baseTexts)this.stringTables[e]=[],this.addTextsToStringTable(e,this.baseTexts[e])}},{key:"get",value:function(e){var t=this.stringTables[this.selectedLanguage][e];return void 0!==t?t:this.stringTables[this.fallbackLanguage][e]}},{key:"addStringTable",value:function(e,t){this.stringTables[e]=t}},{key:"setBaseTexts",value:function(e){this.baseTexts=e}},{key:"addTextsToStringTable",value:function(e,t){for(var n in t)this.stringTables[e][n]=t[n]}},{key:"selectLanguage",value:function(e){this.selectedLanguage=e}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(){return(M="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=N(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function N(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=K(e)););return e}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function B(e,t){if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var U=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&D(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=K(i);if(r){var n=K(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return B(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).guiId=null,void 0!==e?t.setParent(e):t.guiId="globalGUI",t.inputCallbacks={},t.guiElements={},t.blink=!1,t}return t=s,(n=[{key:"initialize",value:function(){M(K(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){M(K(s.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){M(K(s.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){M(K(s.prototype),"step",this).call(this,e)}},{key:"setBlink",value:function(e){var t=this.getParentScene();null!==t&&(!0===e?(this.blink=!0,t.clock.suscribe(this.guiId+"_clock",this,"blinkStep",350)):(this.blink=!1,this.setVisible(!0),t.clock.unsuscribe(this.guiId+"_clock")))}},{key:"blinkStep",value:function(){!0===this.blink&&!0===this.getVisible()?this.setVisible(!1):(!0===this.blink&&!1===this.getVisible()||!1===this.blink)&&this.setVisible(!0)}},{key:"addInputCallback",value:function(e,t){var n=this.getParentScene();null!==n&&(n.input.addKeyListener(this,"eventKeyPressed",[e],!0),this.inputCallbacks[e]=t)}},{key:"eventKeyPressed",value:function(e){void 0!==this.inputCallbacks[e]&&this.inputCallbacks[e]()}},{key:"getElement",value:function(e){var t=this.guiElements[e];return void 0!==t?t:null}},{key:"get",value:function(e){return this.getElement(e)}},{key:"attachItem",value:function(e,t){this.guiElements[t]=e,e.guiId=t,M(K(s.prototype),"attachItem",this).call(this,e)}},{key:"detachItem",value:function(e){void 0!==e&&(M(K(s.prototype),"detachItem",this).call(this,this.get(e)),delete this.guiElements[e])}},{key:"detachAllItems",value:function(){for(var e=Object.keys(this.guiElements),t=0,n=e.length;t<n;t++)this.guiElements[e[t]].detachAllItems(),this.detachItem(e[t]);this.guiElements={},this._finalizeRemoved()}},{key:"_resetItems",value:function(){this.attachedItems.length=0,this.guiElements={}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(A);function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(){return(H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=V(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function V(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=q(e)););return e}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Y(e,t){if(t&&("object"===G(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&W(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=q(i);if(r){var n=q(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Y(this,e)});function s(e,t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this)).text=e,i.font='base,BaseFont,"Courier New"',i.fontSize=20,i.fontColor="#FFFFFF",i.fontBorderColor="#000000",i.textAlign=oe.LEFT,i.verticalOffset=20,i.horizontalOffset=10,void 0===t||void 0===n?(i.size.x=100,i.size.y=30):(i.size.x=t,i.size.y=n),i._canvasRendering=!0,i._innerCanvas=document.createElement("canvas"),i._innerCanvas.width=i.size.x,i._innerCanvas.height=i.size.y,i._innerContext=i._innerCanvas.getContext("2d"),i._innerChange=!0,i}return t=s,(n=[{key:"initialize",value:function(){H(q(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){H(q(s.prototype),"activate",this).call(this)}},{key:"setSize",value:function(e,t){H(q(s.prototype),"setSize",this).call(this,e,t),this._innerCanvas.width=this.size.x,this._innerCanvas.height=this.size.y,this._innerChange=!0}},{key:"setText",value:function(e){this.text!=e&&(this.text=e,this._innerChange=!0)}},{key:"getText",value:function(){return this.text}},{key:"_updateInnerRender",value:function(e){var t=new u(this.horizontalOffset,this.verticalOffset);this.textAlign==oe.CENTER?t.x=this.size.x/2:this.textAlign==oe.RIGHT&&(t.x=this.size.x-this.horizontalOffset),this._innerContext.lineWidth=e.lineWidth,this._innerContext.clearRect(0,0,this.size.x,this.size.y),this._innerContext.strokeStyle=this.fontBorderColor,this._innerContext.fillStyle=this.fontColor,this._innerContext.textAlign=this.textAlign,this._innerContext.font="bold "+this.fontSize+"px "+this.font;for(var n=this.getText().split("\n"),i=0,r=n.length;i<r;i++)this._innerContext.strokeText(n[i],t.x,t.y),this._innerContext.fillText(n[i],t.x,t.y),t.y+=this.verticalOffset;this._innerChange=!1}},{key:"draw",value:function(e){if(!0===this.getVisible()){var t=this.getPosition(),n=this.getSize();if(!1===this._canvasRendering){var i=new u(this.horizontalOffset,this.verticalOffset);this.textAlign==oe.CENTER?i.x=this.size.x/2:this.textAlign==oe.RIGHT&&(i.x=this.size.x-this.horizontalOffset),e.strokeStyle=this.fontBorderColor,e.fillStyle=this.fontColor,e.textAlign=this.textAlign,e.font="bold "+this.fontSize+"px "+this.font;for(var r=this.getText().split("\n"),o=0,a=r.length;o<a;o++)e.strokeText(r[o],t.x-n.x/2+i.x,t.y-n.y/2+i.y),e.fillText(r[o],t.x-n.x/2+i.x,t.y-n.y/2+i.y),i.y+=this.verticalOffset}else!0===this._innerChange&&this._updateInnerRender(e),e.drawImage(this._innerCanvas,t.x-this.size.x/2,t.y-this.size.y/2)}H(q(s.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){H(q(s.prototype),"step",this).call(this,e)}},{key:"setFont",value:function(e){this.font=e}},{key:"setFontSize",value:function(e){this.fontSize=e}},{key:"setFontColor",value:function(e){this.fontColor=e}},{key:"setFontBorderColor",value:function(e){this.fontBorderColor=e}},{key:"setAlign",value:function(e){this.textAlign=e}},{key:"setCanvasRendering",value:function(e){this._canvasRendering=e}},{key:"setVerticalOffset",value:function(e){this.verticalOffset=e}},{key:"setHorizontalOffset",value:function(e){this.horizontalOffset=e}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(U);function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(){return(Z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=J(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function J(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=te(e)););return e}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(e,t){if(t&&("object"===X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function te(e){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=te(i);if(r){var n=te(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ee(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this))._texts={},e._textKeys=[],e._textsToRemove=[],e.order=ie.DOWN,e}return t=s,(n=[{key:"initialize",value:function(){Z(te(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){Z(te(s.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){Z(te(s.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){var t=this._textKeys.length;if(0!==t){for(var n=0,i=(new Date).getTime(),r=0;r<t;r++){var o=this._texts[this._textKeys[r]],a=o[1];o[2]+2e3<i?this._textsToRemove.push(this._textKeys[r]):(a.setPosition(0,n),this.order==ie.DOWN?n+=20:n-=20)}if(Z(te(s.prototype),"step",this).call(this,e),(t=this._textsToRemove.length)>0){for(var c=0;c<t;c++)this.detachItem(this._textsToRemove[c]),delete this._texts[this._textsToRemove[c]];this._textKeys=Object.keys(this._texts),this._textsToRemove=[]}}}},{key:"addText",value:function(e,t){if(void 0!==this._texts[e])this._texts[e][0]!=t&&(this._texts[e][0]=t,this._texts[e][1].setText(t)),this._texts[e][2]=(new Date).getTime();else{var n=new Q(t,this.size.x,this.size.y);n.setSize(this.size.x,this.size.y),this._texts[e]=[t,n,(new Date).getTime()],this._textKeys=Object.keys(this._texts),this.attachItem(n,e)}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(U),ie={UP:0,DOWN:1},re={SELECTION:0},oe={LEFT:"left",RIGHT:"right",CENTER:"center"};function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ae(){return(ae="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=ce(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function ce(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=he(e)););return e}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ue(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return fe(e)}function fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&le(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=he(i);if(r){var n=he(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ue(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).playable=!1,e.backgrounds=[],e.isCurrent=!1,e.gui=new U(fe(e)),e.clock=new I,e.input=new y,e}return t=s,(n=[{key:"initialize",value:function(){var e=this;ae(he(s.prototype),"initialize",this).call(this);var t=new ne;t.setSize(170,30),t.setPosition(15+t.size.x/2,15+t.size.y/2),t.order=ie.DOWN,this.gui.initialize(),this.gui.attachItem(t,"console"),this.clock.initialize(),xe.clock.suscribeOneSecond("FPS",(function(){xe.options.showFps&&e.gui.get("console").addText("fps",xe.core.fpsPassed+" fps"),xe.core.fpsPassed=0})),this.input.initialize()}},{key:"activate",value:function(){ae(he(s.prototype),"activate",this).call(this),this.gui.activate(),this.clock.activate(),this.input.activate();for(var e=0,t=this.backgrounds.length;e<t;e++)this.backgrounds[e].activate()}},{key:"draw",value:function(e){e.clearRect(0,0,xe.core.size.x,xe.core.size.y);for(var t=0,n=this.backgrounds.length;t<n;t++)this.backgrounds[t].draw(e);ae(he(s.prototype),"draw",this).call(this,e),this.gui.draw(e)}},{key:"step",value:function(e){for(var t=0,n=this.backgrounds.length;t<n;t++)this.backgrounds[t].step(e);this.clock.step(e),ae(he(s.prototype),"step",this).call(this,e),this.gui.step(e)}},{key:"addBackground",value:function(e){this.backgrounds.push(e)}},{key:"pauseGame",value:function(){if(null===this.gui.get("pause")){var e=new Q(xe.localization.get("paused"),500,30);e.setFontColor("#FF2222"),e.setAlign(oe.CENTER),e.setPosition(xe.core.size.x/2,xe.core.size.y/2+100),this.gui.attachItem(e,"pause")}}},{key:"unpauseGame",value:function(){this.gui.detachItem("pause")}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(A);function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}if(!Object.defineProperty)throw"Font.js requires Object.defineProperty, which this browser does not support.";if(!document.createElement("canvas").getContext)throw"Font.js requires <canvas> and the Canvas2D API, which this browser does not support.";function de(){this.fontFamily="fjs"+(999999*Math.random()|0)}!function(e){try{return void new Uint8Array(1)}catch(e){}function t(e,t){return this.slice(e,t)}function n(e,t){var n,i=e.length;for(arguments.length<2&&(t=0),n=0;n<i;++n,++t)this[t]=255&e[n]}function i(e){var i,r;if("number"==typeof e)for(i=new Array(e),r=0;r<e;++r)i[r]=0;else i=e.slice(0);return i.subarray=t,i.buffer=i,i.byteLength=i.length,i.set=n,"object"===ye(e)&&e.buffer&&(i.buffer=e.buffer),i}e.Uint8Array=i,e.Uint32Array=i,e.Int32Array=i}(window),function(e){var t;e.opera||"response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype||(t=e.VBArray?function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}:function(){this.responseBody},Object.defineProperty(XMLHttpRequest.prototype,"response",{get:t}))}(window),window.btoa||(window.btoa=function(e){var t,n,i,r,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,c=0,l="",u=[];if(!e)return e;do{t=(o=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,n=o>>12&63,i=o>>6&63,r=63&o,u[c++]=s.charAt(t)+s.charAt(n)+s.charAt(i)+s.charAt(r)}while(a<e.length);l=u.join("");var f=e.length%3;return(f?l.slice(0,f-3):l)+"===".slice(f||3)}),de.prototype.url="",de.prototype.format="",de.prototype.data="",de.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==",de.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400},de.prototype.systemfont=!1,de.prototype.loaded=!1,de.prototype.onload=function(){},de.prototype.onerror=function(){},de.prototype.canvas=!1,de.prototype.context=!1,de.prototype.validate=function(e,t,n,i,r){!1!==r&&r<0?this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed)."):getComputedStyle(e,null).getPropertyValue("width").replace("px","")>0?(document.head.removeChild(t),document.body.removeChild(e),this.loaded=!0,this.onload()):(console.log("timing out"),setTimeout((function(){i.validate(e,t,n,i,!1!==r&&r-50)}),1e3))},de.prototype.ondownloaded=function(){var e=this,t=function(e){return String.fromCharCode(e)},n=function(e){if(e<256)return t(0)+t(e);var n=255&e;return t(e>>8)+t(n)},i=function(e,t){return 256*e+t},r=function(e,t){var n,i=e>>7==1;return n=256*(e&=127)+t,i?n-32768:n},o=function(e,t,n,i){return 16777216*e+65536*t+256*n+i},s=function(t){e.onerror(t)},a=t(0)+t(1)+t(0)+t(0),c=this.data,l=t(c[0])+t(c[1])+t(c[2])+t(c[3]),u=l===a,f=!u&&"OTTO"===l;if(u)this.format="truetype";else{if(!f)return void s("Error: file at "+this.url+" cannot be interpreted as OpenType font.");this.format="opentype"}var h,p,y=i(c[4],c[5]),d=12+16*y,v={};for(h=12;h<d;h+=16)p=t(c[h])+t(c[h+1])+t(c[h+2])+t(c[h+3]),v[p]={name:p,checksum:o(c[h+4],c[h+5],c[h+6],c[h+7]),offset:o(c[h+8],c[h+9],c[h+10],c[h+11]),length:o(c[h+12],c[h+13],c[h+14],c[h+15])};var g=function(e){return v[e]?e:(s("Error: font is missing the required OpenType '"+e+"' table."),!1)};if(!1!==(p=g("head"))){h=v[p].offset,v[p].version=""+c[h]+c[h+1]+c[h+2]+c[h+3];var m=i(c[h+18],c[h+19]);if(this.metrics.quadsize=m,!1!==(p=g("hhea"))&&(h=v[p].offset,v[p].version=""+c[h]+c[h+1]+c[h+2]+c[h+3],this.metrics.ascent=r(c[h+4],c[h+5])/m,this.metrics.descent=r(c[h+6],c[h+7])/m,this.metrics.leading=r(c[h+8],c[h+9])/m,!1!==(p=g("OS/2"))&&(h=v[p].offset,v[p].version=""+c[h]+c[h+1],this.metrics.weightclass=i(c[h+4],c[h+5]),!1!==(p=g("cmap"))))){h=v[p].offset,v[p].version=""+c[h]+c[h+1],y=i(c[h+2],c[h+3]);for(var b,A,w,O,k=!1,P=0;P<y;P++)A=i(c[b=h+4+8*P],c[b+1]),w=i(c[b+2],c[b+3]),O=o(c[b+4],c[b+5],c[b+6],c[b+7]),3===A&&1===w&&(k=O);var x="A";if(!1!==k&&4===(l=i(c[h+=k],c[h+1]))){for(var S=function(e){return-1===[9,10,11,12,13,32,127,128,129,141,142,143,144,149,157,158,160,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8232,8233,8234,8235,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,12288].indexOf(e)},R=h+14,E=h+14+i(c[h+6],c[h+7])/2*2,_=!1;R<E&&!S(_=i(c[R],c[R+1]));R+=2)_=!1;if(0!=_){x=String.fromCharCode(_);var T=(65536-(_-1))%65536,z=t(0)+n(_)+n(65535)+n(0)+n(_)+n(65535)+n(T)+n(1),j=btoa(z);this.base64=this.base64.substring(0,380)+j+this.base64.substring(380+j.length)}}this.bootstrapValidation(x,!1)}}},de.prototype.bootstrapValidation=function(e,t){var n=this.fontFamily+" testfont",i=document.createElement("style");i.setAttribute("type","text/css"),i.innerHTML="@font-face {\n  font-family: '"+n+"';\n  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n       format('truetype');}",document.head.appendChild(i);var r=!1;this.systemfont||(r=this.toStyleNode(),document.head.appendChild(r));var o=document.createElement("p");if(o.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;",o.style.fontFamily="'"+this.fontFamily+"', '"+n+"'",o.innerHTML=e+e+e+e+e+e+e+e+e+e,document.body.appendChild(o),"undefined"==typeof getComputedStyle)this.onload(),error("Error: getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.");else{var s=this.systemfont?1e3:this.metrics.quadsize,a=document.createElement("canvas");a.width=s,a.height=s,this.canvas=a;var c=a.getContext("2d");c.font="1em '"+this.fontFamily+"'",c.fillStyle="white",c.fillRect(-1,-1,s+2,s+2),c.fillStyle="black",c.fillText("test text",50,s/2),this.context=c;var l=this;setTimeout((function(){l.validate(o,i,r,l,t)}),50)}},de.prototype.processSystemFont=function(){this.systemfont=!0,this.metrics=!1,this.bootstrapValidation("A",1e3)},de.prototype.loadFont=function(){var e=this;if(-1!==this.url.indexOf(".")){var t=new XMLHttpRequest;t.open("GET",e.url,!0),t.responseType="arraybuffer",t.onload=function(n){var i=t.response;i?(e.data=new Uint8Array(i),e.ondownloaded()):e.onerror("Error downloading font resource from "+e.url)},t.onerror=function(t){e.onerror("Error downloading font resource from "+e.url)},t.send(null)}else setTimeout((function(){e.processSystemFont()}),10)},de.prototype.styleNode=!1,de.prototype.toStyleNode=function(){if(this.styleNode)return this.styleNode;this.styleNode=document.createElement("style"),this.styleNode.type="text/css",this.url.replace(".ttf",".eot");var e="@font-face {\n";return e+="  font-family: '"+this.fontFamily+"';\n",e+="  src: url('"+this.url+"') format('"+this.format+"');\n",e+="}",this.styleNode.innerHTML=e,this.styleNode},de.prototype.measureText=function(e,t){if(!this.loaded)return this.onerror("measureText() was called while the font was not yet loaded"),!1;this.context.font=t+"px '"+this.fontFamily+"'";var n=this.context.measureText(e);n.fontsize=t,n.ascent=0,n.descent=0,n.bounds={minx:0,maxx:n.width,miny:0,maxy:0},n.height=0;var i=[];n.width,this.metrics.quadsize,i.push(e);var r,o=i.length;for(r=0;r<o;r++)this.measureSegment(i[r],t,n);return n},de.prototype.measureSegment=function(e,t,n){var i=document.createElement("div");for(i.style.position="absolute",i.style.opacity=0,i.style.font=t+"px '"+this.fontFamily+"'",i.innerHTML=e,g=1;g<10;g++)i.innerHTML+="<br/>"+e;document.body.appendChild(i),n.leading=1.2*t;var r,o=(r=i,document.defaultView.getComputedStyle(r,null).getPropertyValue("height"));if((o=o.replace("px",""))>=10*t&&(n.leading=o/10|0),document.body.removeChild(i),/^\s*$/.test(e))return n;this.canvas;var s=this.context,a=this.systemfont?1e3:this.metrics.quadsize,c=a,l=a,u=a/2,f=(a-n.width)/2;f!==(0|f)&&(f|=0),s.fillStyle="white",s.fillRect(-50,-50,c+100,l+100),s.fillStyle="black",s.fillText(e,f,u);for(var h=n.width+50|0,p=4*t,y=f-25,d=u-p/2,v=s.getImageData(y,d,h,p).data,g=0,m=0,b=4*h,A=v.length,w=p/2;++g<A&&255===v[g];);var O=g/b|0;for(g=A-1;--g>0&&255===v[g];);var k=g/b|0;for(g=0,m=0;m<h&&255===v[g];)(g+=b)>=A&&(m++,g=g-A+4);var P=m,x=1;for(g=A-3,m=0;m<h&&255===v[g];)(g-=b)<0&&(m++,g=A-3-4*x++);var S=h-m;return n.ascent=w-O,n.descent=k-w,n.bounds={minx:P-25,maxx:S-25,miny:-n.descent,maxy:n.ascent},n.height=k-O+1,n},Object.defineProperty(de.prototype,"src",{set:function(e){this.url=e,this.loadFont()}}),void 0===(i=function(){return de}.call(t,n,t,e))||(e.exports=i);const ve=de;function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(){return(me="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=be(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function be(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Oe(e)););return e}function Ae(e,t){return(Ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function we(e,t){if(t&&("object"===ge(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ae(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Oe(i);if(r){var n=Oe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return we(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).timeStarted=0,e.percentageLoaded=0,e.incremental=0,e.imageAssets=[],e.totalImages=0,e.soundAssets=[],e.totalFonts=0,e.message=null,e}return t=s,(n=[{key:"initialize",value:function(){me(Oe(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){var e,t,n;for(xe.logs.log("Preloader::activate","Loading assets"),me(Oe(s.prototype),"activate",this).call(this),this.timeStarted=(new Date).getTime(),e=0,t=this.imageAssets.length;e<t;e++)n=this.imageAssets[e],this.addImageToLoad(n);for(e=0,t=this.soundAssets.length;e<t;e++)n=this.soundAssets[e],this.addSoundToLoad(n);this.message=new Q(xe.localization.get("loaded")+" "+this.percentageLoaded+"%",300,30),this.message.setPosition(xe.core.size.x/2,xe.core.size.y/2+100),this.message.setAlign(oe.CENTER),this.message.setVerticalOffset(20),this.message.setFontColor("#FF2222"),this.gui.attachItem(this.message,"msg_loading")}},{key:"addAnimation",value:function(e){this.imageAssets.push(e)}},{key:"addSprite",value:function(e){e.xStart=0,e.yStart=0,e.frames=1,e.initFrame=0,e.speed=0,this.addAnimation(e)}},{key:"addImageToLoad",value:function(e){var t=null;xe.sprites.imageExists(e.path)||(f("load",t=new Image,(function(){xe.preloader.incrementalLoader()})),null!==xe.options.assetsURLPrefix?t.src=xe.options.assetsURLPrefix+e.path:t.src=h()+e.path,this.totalImages++,xe.sprites.addImage(e.path,t)),xe.sprites.spriteExists(e.name)||xe.sprites.addSprite(e.name,e.path,e.xStart,e.yStart,e.width,e.height,e.frames,e.initFrame,e.speed)}},{key:"addSound",value:function(e){this.soundAssets.push(e)}},{key:"addSoundToLoad",value:function(e){var t=null;if(!xe.sounds.soundExists(e.path)){var n=e.path;n=null!==xe.options.assetsURLPrefix?xe.options.assetsURLPrefix+n:h()+n,(t=new Audio(n)).load(),f("canplaythrough",t,(function(){xe.preloader.incrementalLoader("sound")})),xe.sounds.addSound(e.name,e.path,t)}}},{key:"addFont",value:function(e){var t=new ve;this.totalFonts++,t.onerror=function(e){xe.logs.log("Preloader::addFont","Error loading a font: "+e)},t.onload=function(){xe.logs.log("Preloader::addFont","Font loaded <"+t.fontFamily+">"),xe.preloader.incrementalLoader("font")},t.fontFamily=e.name,void 0!==e.flag?t.src=e.path:null!==xe.options.assetsURLPrefix?t.src=xe.options.assetsURLPrefix+e.path:t.src=h()+e.path,xe.fonts.addFont(e.name,e.path,t)}},{key:"incrementalLoader",value:function(){var e=this.totalImages+this.soundAssets.length+this.totalFonts;this.incremental+=1,this.percentageLoaded=Math.floor(100*this.incremental/e)}},{key:"draw",value:function(e){me(Oe(s.prototype),"draw",this).call(this,e);var t=xe.core.size.x/3;e.fillStyle="#FF2222",e.fillRect((xe.core.size.x-t)/2+1,xe.core.size.y/2+51,this.percentageLoaded*t/100,15),e.lineWidth=2,e.strokeStyle="#FFEEEE",e.strokeRect((xe.core.size.x-t)/2,xe.core.size.y/2+50,t+2,16)}},{key:"step",value:function(e){me(Oe(s.prototype),"step",this).call(this,e),this.message.setText(xe.localization.get("loaded")+" "+this.percentageLoaded+"%");var t=(new Date).getTime()-this.timeStarted;this.percentageLoaded>=100&&t>1e3&&(xe.core.activate(),xe.external("LOADED",null,null))}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(pe);var Pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),xe.logs.log("Player::initialize","Initializing player object"),this.avatar=null}var t,n;return t=e,(n=[{key:"getAvatar",value:function(){return this.avatar}},{key:"setAvatar",value:function(e){this.avatar=e}},{key:"initialize",value:function(){}},{key:"activate",value:function(){}},{key:"step",value:function(){}},{key:"draw",value:function(){}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();const xe=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=null,this.logs=null,this.core=null,this.device=null,this.effects=null,this.particles=null,this.sprites=null,this.sounds=null,this.fonts=null,this.clock=null,this.localization=null,this.input=null,this.controls=null,this.scenes=null,this.preloader=null,this.game=null,this.externalCallback=null,this.player=null}var t,n;return t=e,(n=[{key:"initialize",value:function(e,t,n){this.options=new l,this.logs=new Se,this.core=new g,this.device=new m,this.effects=new E,this.particles=new _,this.sprites=new T,this.sounds=new z,this.fonts=new j,this.clock=new I,this.localization=new F,this.input=new p,this.scenes=new C,this.preloader=new ke,this.player=new Pe,this.logs.log("Engine::initialize","Initializing starts..."),this.game=t,void 0!==n&&(this.externalCallback=n),this.core.initialize(e),this.device.initialize(),this.effects.initialize(),this.particles.initialize(),this.sprites.initialize(),this.sounds.initialize(),this.clock.initialize(),this.input.initialize(),this.localization.initialize(),this.scenes.initialize(),this.preloader.playable=!1,this.preloader.initialize(),this.game.initialize()}},{key:"external",value:function(e,t,n){var i=this;"undefined"!=typeof externalCallback&&setTimeout((function(){try{i.externalCallback(e,t,n)}catch(n){i.logs.log("Engine::external","Error with external callback with event "+e+" "+t)}}),1)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}());var Se=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"log",value:function(e,t,n){var i=[];if(!1!==xe.options.debugInConsole)if(!0===xe.options.debugFunctionNames&&i.push(e),Array.isArray(t)?i.push(t.join(" ")):i.push(t),n&&i.push(n),!0===xe.options.debugInHtml&&void 0!==xe.core.canvas){var r=document.createElement("div");r.innerHTML=i,xe.core.canvas.parentNode.appendChild(r)}else void 0===window.console||void 0===window.console.log||window.console.log(i)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Re(e,t){return void 0===t.x||void 0===t.y||void 0===e.x||void 0===e.y?-1:Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Ee(e){var t=new u;return t.x=Math.cos(e),t.y=Math.sin(e),t}function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ze(e,t){if(t&&("object"===_e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function je(e){return(je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ce=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Te(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=je(i);if(r){var n=je(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ze(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this)).setPosition(e.x,e.y),n.setSpeed(t.x,t.y),n.ttl=-1,n.lived=0,n.color=[],n.size=2,n}return t=s,(n=[{key:"initialize",value:function(){}},{key:"activate",value:function(){}},{key:"step",value:function(e){this.move(this.speed.x*e/xe.core.TIME_PER_FRAME,this.speed.y*e/xe.core.TIME_PER_FRAME),this.lived++}},{key:"draw",value:function(){}},{key:"collide",value:function(){return!1}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(A);function Ie(e){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fe(){return(Fe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=Le(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function Le(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=De(e)););return e}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ne(e,t){if(t&&("object"===Ie(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Be=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Me(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=De(i);if(r){var n=De(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ne(this,e)});function s(e,t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this)).size=new u(10,10),i.particleSpeed=e,i.magnitude=t,i.particleColor=[255,255,255,255],i.particleLife=100,i.particleSize=3,i.started=!1,i.spread=n,i.emissionRate=3,i}return t=s,(n=[{key:"start",value:function(){this.started=!0}},{key:"stop",value:function(){this.started=!1}},{key:"createParticle",value:function(){var e=Math.random()*this.spread-this.spread/2,t=Ee(this.getRotation()+e);t=t.normalize();var n=new u(t.x*this.particleSpeed,t.y*this.particleSpeed),i=this.getPosition(),r=new Ce(i,n);r.ttl=Math.random()*this.particleLife,r.color=this.particleColor,r.size=this.particleSize,xe.particles.addParticle(r)}},{key:"step",value:function(e){if(Fe(De(s.prototype),"step",this).call(this,e),!0===this.started)for(var t=0;t<this.emissionRate;t++)this.createParticle()}},{key:"draw",value:function(e){Fe(De(s.prototype),"draw",this).call(this,e)}},{key:"collide",value:function(){return!1}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(A);function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ue(){return(Ue="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=Ge(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function Ge(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=We(e)););return e}function He(e,t){return(He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ve(e,t){if(t&&("object"===Ke(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ye=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&He(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=We(i);if(r){var n=We(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ve(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).backgroundType="image",e.color="black",e.spriteName=null,e.position.x=xe.core.size.x/2,e.position.y=xe.core.size.y/2,e.pauseScroll=!1,e.verticalScroll=!1,e.verticalOffset=0,e.verticalSpeed=0,e.horizontalScroll=!1,e.horizontalOffset=0,e.horizontalSpeed=0,e}return t=s,(n=[{key:"initialize",value:function(){Ue(We(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){Ue(We(s.prototype),"activate",this).call(this),this.verticalOffset=0,this.horizontalOffset=0}},{key:"step",value:function(e){Ue(We(s.prototype),"step",this).call(this,e),!1===this.pauseScroll&&(!0===this.verticalScroll?(this.verticalOffset+=this.verticalSpeed*e/xe.core.TIME_PER_FRAME,this.verticalOffset=Math.floor(this.verticalOffset%xe.core.size.y)):!0===this.horizontalScroll&&(this.horizontalOffset+=this.horizontalSpeed*e/xe.core.TIME_PER_FRAME,this.horizontalOffset=Math.floor(this.horizontalOffset%xe.core.size.x)))}},{key:"draw",value:function(e){if("color"==this.backgroundType)e.fillStyle=this.color,e.fillRect(0,0,xe.core.size.x,xe.core.size.y);else if("image"==this.backgroundType){var t,n;!0===this.verticalScroll?(t=Math.floor(this.verticalOffset),n=xe.core.size.y-t,t>0&&e.drawImage(xe.sprites.getImage(this.spriteName),0,n,xe.core.size.x,t,0,0,xe.core.size.x,t),n>0&&e.drawImage(xe.sprites.getImage(this.spriteName),0,0,xe.core.size.x,n,0,t,xe.core.size.x,n)):!0===this.horizontalScroll?(t=Math.floor(this.horizontalOffset),n=xe.core.size.x-t,t>0&&e.drawImage(xe.sprites.getImage(this.spriteName),0,0,t,xe.core.size.y,n,0,t,xe.core.size.y),n>0&&e.drawImage(xe.sprites.getImage(this.spriteName),t,0,n,xe.core.size.y,0,0,n,xe.core.size.y)):xe.sprites.draw(e,this)}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(A);function qe(e,t,n){return"complete"===document.readyState?xe.initialize(e,t,n):f("load",window,(function(){xe.initialize(e,t,n)})),xe}return o})()}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";n.r(i),n.d(i,{default:()=>Ae});var e=n(375);function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var o=r((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultLanguage="english",this.debugInConsole=!0,this.meteorPeriodicity=500,this.shotPeriodicity=200}));function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(f,t);var n,i,r,o,s=(r=f,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=u(r);if(o){var n=u(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return l(this,e)});function f(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(e=s.call(this)).BACKGROUND_SPEED=8,e.BACKGROUND_STARS=30,e.speeds=[],e.offsets=[],e.parallaxDisplacement=5,e.starfields=[],e}return n=f,(i=[{key:"initialize",value:function(){for(var t=0;t<3;t++){this.starfields[t]=document.createElement("canvas"),this.starfields[t].layer=t,this.starfields[t].width=e.engine.core.size.x+(t+1)*this.parallaxDisplacement,this.starfields[t].height=e.engine.core.size.y,this.starfields[t].ctx=this.starfields[t].getContext("2d"),this.speeds[t]=this.BACKGROUND_SPEED+7*(t+1),this.offsets[t]=0,0===t&&(this.starfields[t].ctx.fillStyle="#000",this.starfields[t].ctx.fillRect(0,0,this.starfields[t].width,this.starfields[t].height)),this.starfields[t].ctx.fillStyle="#FFF",this.starfields[t].ctx.globalAlpha=2*(t+1)/10;for(var n=0;n<this.BACKGROUND_STARS;n++)this.starfields[t].ctx.fillRect(Math.floor(Math.random()*this.starfields[t].width),Math.floor(Math.random()*this.starfields[t].height),t+1,t+1)}}},{key:"step",value:function(e){for(var t=0;t<3;t++)this.offsets[t]+=this.speeds[t]/e,this.offsets[t]=this.offsets[t]%this.starfields[t].height}},{key:"draw",value:function(t){for(var n=0;n<3;n++){var i=Math.floor(this.offsets[n]),r=this.starfields[n].height-i,o=this.starfields[n].width,s=void 0;if(void 0===e.engine.player||null===e.engine.player||e.engine.currentScene<=2)s=(n+1)*this.parallaxDisplacement*(e.engine.core.size.x/2)/e.engine.core.size.x;else{var a=e.engine.player.getAvatar().getPosition().x;(s=Math.round((n+1)*this.parallaxDisplacement*a/e.engine.core.size.x))<0?s=0:s+e.engine.core.size.x>o&&(s=o-e.engine.core.size.x)}i>0&&t.drawImage(this.starfields[n],0+s,r,e.engine.core.size.x,i,0,0,e.engine.core.size.x,i),r>0&&t.drawImage(this.starfields[n],0+s,0,e.engine.core.size.x,r,0,i,e.engine.core.size.x,r)}}}])&&a(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),f}(e.Background);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=d(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function d(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){if(t&&("object"===h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(a,t);var n,i,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(r);if(o){var n=m(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),s.call(this)}return n=a,(i=[{key:"initialize",value:function(){y(m(a.prototype),"initialize",this).call(this),this.input.addKeyListener(this,"eventKeyPressed",[e.INPUT.KEYS.SPACEBAR])}},{key:"activate",value:function(){var t=e.engine.player.getAvatar();t.setPosition(e.engine.core.size.x/2,e.engine.core.size.y/2),this.attachItem(t),y(m(a.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){y(m(a.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){y(m(a.prototype),"step",this).call(this,e)}},{key:"eventKeyPressed",value:function(t){t==e.INPUT.KEYS.SPACEBAR&&e.engine.scenes.advanceScene()}}])&&p(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(e.Scene);function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function O(){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=k(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function k(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t){if(t&&("object"===A(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&P(e,t)}(a,t);var n,i,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=S(r);if(o){var n=S(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return x(this,e)});function a(t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(i=s.call(this)).spriteName="meteor",i.size.x=e.engine.sprites.sprites[i.spriteName][3],i.size.y=e.engine.sprites.sprites[i.spriteName][4],i.linearSpeed=n,i.vRot=Math.PI/600,i.scaling.x=t,i.scaling.y=t,i.maxRadius=i.getRadius(),i.collisionRadius=29,i}return n=a,(i=[{key:"step",value:function(e){O(S(a.prototype),"step",this).call(this,e)}},{key:"draw",value:function(e){O(S(a.prototype),"draw",this).call(this,e)}},{key:"collide",value:function(t){O(S(a.prototype),"collide",this).call(this);var n=t.speed.x,i=t.speed.y;t instanceof F&&(n=t.speed.x/10,i=t.speed.y/10);var r=e.engine.effects.addEffect("halo",this.position.x,this.position.y,this.speed.x+n,this.speed.y+i);r.initialScaling=2,r.finalScaling=3,r.lifeTime=20,r.vRot=Math.PI/100,r.transparencyMethod=2;for(var o=0;o<10;o++)(r=e.engine.effects.addEffect("explosion",this.position.x+40*(Math.random()-.5),this.position.y+40*(Math.random()-.5),this.speed.x+(Math.random()-.5),this.speed.y+(Math.random()-.5))).scaling.x=Math.abs(Math.random()-.1),r.scaling.y=r.scaling.x,r.vRot=(Math.random()-.5)*Math.PI/50,r.lifeTime=100,r.isAnimated=!0,r.transparencyMethod=Math.floor(3*Math.random());return e.engine.sounds.play("explosion"),!0}}])&&w(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(e.Item);function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function T(){return(T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=z(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function z(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t){if(t&&("object"===E(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var F=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&j(e,t)}(a,t);var n,i,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=I(r);if(o){var n=I(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return C(this,e)});function a(t,n,i){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=s.call(this)).spriteName="shot",r.creator=t,r.size.x=e.engine.sprites.sprites[r.spriteName][3],r.size.y=e.engine.sprites.sprites[r.spriteName][4],r.position=n,r.speedMagnitude=5,r.setRotation(i);var o=e.MATH.angleToDirectionVector(i);return o=o.normalize(),r.speed.x=o.x*r.speedMagnitude,r.speed.y=o.y*r.speedMagnitude,r.maxRadius=r.getRadius(),r.collisionRadius=12,r}return n=a,(i=[{key:"step",value:function(e){T(I(a.prototype),"step",this).call(this,e)}},{key:"draw",value:function(e){T(I(a.prototype),"draw",this).call(this,e)}},{key:"collide",value:function(t){return!(t instanceof a||t==this.creator||(t instanceof R&&e.engine.game.points.add(50),T(I(a.prototype),"collide",this).call(this),0))}}])&&_(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(e.Item);function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function N(){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=D(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function D(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e,t){if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var G=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(a,t);var n,i,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(r);if(o){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return K(this,e)});function a(){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=s.call(this)).size=new e.MATH.Point(10,10),t}return n=a,(i=[{key:"step",value:function(e){N(U(a.prototype),"step",this).call(this,e)}},{key:"draw",value:function(e){N(U(a.prototype),"draw",this).call(this,e)}},{key:"shoot",value:function(t){var n=new F(t,this.getPosition(),this.getRotation());e.engine.scenes.getCurrentScene().attachItem(n)}},{key:"collide",value:function(){return!1}}])&&M(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(e.Item);function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function W(){return(W="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=Y(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function Y(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=X(e)););return e}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e,t){if(t&&("object"===H(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Z=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(a,t);var n,i,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=X(r);if(o){var n=X(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Q(this,e)});function a(t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this)).spriteName=t,n.size.x=e.engine.sprites.sprites[n.spriteName][3],n.size.y=e.engine.sprites.sprites[n.spriteName][4],n.maxRadius=n.getRadius(),n.collisionRadius=24,n.gunRack=[],n.motorEffect=null,n}return n=a,(i=[{key:"initialize",value:function(){W(X(a.prototype),"initialize",this).call(this),this.motorEffect=new e.Emitter(1,1,Math.PI/5),this.motorEffect.setPosition(-20,-1),this.motorEffect.setRotation(Math.PI),this.attachItem(this.motorEffect);var t=new G;t.setPosition(20,0),this.gunRack.push(t),this.attachItem(t),this.setRotation(-Math.PI/2)}},{key:"step",value:function(t){W(X(a.prototype),"step",this).call(this,t),!0===e.engine.player.isThrusting?this.motorEffect.start():this.motorEffect.stop()}},{key:"draw",value:function(e){W(X(a.prototype),"draw",this).call(this,e)}},{key:"collide",value:function(t){return t instanceof F&&t.creator==this||(this.speed.x=this.speed.x/10,this.speed.y=this.speed.y/10,e.engine.game.points.add(-10)),!1}},{key:"shoot",value:function(){for(var t=0,n=this.gunRack.length;t<n;t++)this.gunRack[t].shoot(this);e.engine.sounds.play("shot")}}])&&V(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(e.Item);function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ee(){return(ee="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=te(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function te(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=re(e)););return e}function ne(e,t){return(ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ie(e,t){if(t&&("object"===J(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var oe=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ne(e,t)}(a,t);var n,i,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=re(r);if(o){var n=re(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ie(this,e)});function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=s.call(this)).timeLastMeteor=0,e}return n=a,(i=[{key:"initialize",value:function(){ee(re(a.prototype),"initialize",this).call(this);var t=new e.GUI.GuiText;t.setSize(250,30),t.setPosition(15+t.size.x/2,e.engine.core.size.y-15-t.size.y/2),t.setText(e.engine.localization.get("points")+": 0"),this.gui.attachItem(t,"points")}},{key:"activate",value:function(){this.attachItem(e.engine.player.getAvatar()),ee(re(a.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){ee(re(a.prototype),"draw",this).call(this,e)}},{key:"step",value:function(t){ee(re(a.prototype),"step",this).call(this,t),this.checkBoundaries(),this.checkCollisions();var n=(new Date).getTime();if(n-this.timeLastMeteor>e.engine.options.meteorPeriodicity){this.timeLastMeteor=n;var i=new R(1,1.5),r=Math.floor(4*Math.random()),o=Math.random()*Math.PI;switch(r){case 0:i.position.x=Math.random()*e.engine.core.size.x,i.position.y=1-i.size.y;break;case 1:i.position.x=1-i.size.x,i.position.y=Math.random()*e.engine.core.size.y,o+=Math.PI/2;break;case 2:i.position.x=Math.random()*e.engine.core.size.x,i.position.y=e.engine.core.size.y+i.size.y-1,o-=Math.PI;break;default:case 3:i.position.x=e.engine.core.size.x+i.size.x-1,i.position.y=Math.random()*e.engine.core.size.y,o-=Math.PI/2}var s=e.MATH.angleToDirectionVector(o);s=s.normalize(),i.speed.x=s.x*i.linearSpeed,i.speed.y=s.y*i.linearSpeed,this.attachItem(i)}}},{key:"checkBoundaries",value:function(){var t;this._resetRemoved();for(var n=0;n<this.getAttachedItems().length;n++)((t=this.getAttachedItems()[n]).position.x>e.engine.core.size.x+t.size.x||t.position.x<0-t.size.x||t.position.y<0-t.size.y||t.position.y>e.engine.core.size.y+t.size.y)&&this.detachItem(t);this._finalizeRemoved()}},{key:"checkCollisions",value:function(){var t,n;this._resetRemoved();for(var i=0;i<this.getAttachedItems().length;i++)if(0!==(t=this.getAttachedItems()[i]).collisionRadius)for(var r=i+1;r<this.getAttachedItems().length;r++)0!==(n=this.getAttachedItems()[r]).collisionRadius&&(Math.abs(t.position.x-n.position.x)>t.size.x/2+n.size.x/2||Math.abs(t.position.y-n.position.y)>t.size.y/2+n.size.y/2||e.MATH.pointDistance(t.position,n.position)<=t.collisionRadius+n.collisionRadius&&(!0===t.collide(n)&&this.detachItem(t),!0===n.collide(t)&&this.detachItem(n)));this._finalizeRemoved()}}])&&$(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(e.Scene);function se(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ae=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}var n,i;return n=t,(i=[{key:"initialize",value:function(){e.engine.preloader.addSprite({name:"starship",path:"assets/images/ship.png",width:50,height:50}),e.engine.preloader.addSprite({name:"meteor",path:"assets/images/meteor.png",width:60,height:60}),e.engine.preloader.addSprite({name:"shot",path:"assets/images/shot.png",width:10,height:10}),e.engine.preloader.addAnimation({name:"explosion",path:"assets/images/effect.explosion.png",xStart:0,yStart:0,width:48,height:47,frames:11,initFrame:0,speed:14}),e.engine.preloader.addSprite({name:"halo",path:"assets/images/effect.halo.png",width:63,height:63}),e.engine.preloader.addSound({name:"explosion",path:"assets/sounds/fridobeck_explosion.mp3"}),e.engine.preloader.addSound({name:"shot",path:"assets/sounds/halgrimm_shot.mp3"}),e.engine.preloader.addFont({name:"baseFont",path:"assets/fonts/visitor1.ttf"}),e.engine.preloader.addBackground(e.engine.game.commonBackground),e.engine.preloader.initialize(),e.engine.scenes.addScene(e.engine.preloader,"preloader"),e.engine.scenes.setScene(0),e.engine.localization.addTextsToStringTable("english",this.localization_en()),e.engine.localization.addTextsToStringTable("spanish",this.localization_es()),e.engine.localization.selectLanguage(e.engine.game.options.defaultLanguage)}},{key:"localization_en",value:function(){return{game_name:"Game",press_spacebar:"Press the spacebar to start",touch_screen:"Touch the screen to continue",points:"Points",accumulated:"Accumulated points",totals:"Total points"}}},{key:"localization_es",value:function(){return{game_name:"Juego",press_spacebar:"Pulsa espacio para comenzar",touch_screen:"Toca la pantalla para continuar",points:"Puntos",accumulated:"Puntos acumulados",totals:"Puntos totales"}}}])&&se(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ue(){return(ue="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=fe(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function fe(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ye(e)););return e}function he(e,t){return(he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e,t){if(t&&("object"===ce(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var de=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&he(e,t)}(a,t);var n,i,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ye(r);if(o){var n=ye(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return pe(this,e)});function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=s.call(this)).avatar=null,e.timeLastShot=0,e.isTurningLeft=!1,e.isTurningRight=!1,e.isThrusting=!1,e.rotationSpeed=Math.PI/50,e.flightSpeed=.05,e}return n=a,(i=[{key:"initialize",value:function(){ue(ye(a.prototype),"initialize",this).call(),this.avatar=new Z("starship"),this.avatar.initialize()}},{key:"activate",value:function(){ue(ye(a.prototype),"activate",this).call(),this.timeLastShot=0,this.isTurningLeft=!1,this.isTurningRight=!1,this.isThrusting=!1,this.getAvatar().getParentScene().input.addKeyListener(this,"eventKeyPressed",[e.INPUT.KEYS.SPACEBAR])}},{key:"eventKeyPressed",value:function(t){if(!0!==e.engine.core.paused&&t==e.INPUT.KEYS.SPACEBAR){var n=(new Date).getTime();n-this.timeLastShot>e.engine.options.shotPeriodicity&&(this.avatar.shoot(),this.timeLastShot=n)}}},{key:"step",value:function(){if(void 0===this.getAvatar().getParentScene()||null===this.getAvatar().getParentScene()||!1!==this.getAvatar().getParentScene().playable){if(e.engine.input.isKeyPressed(e.INPUT.KEYS.LEFT)?this.isTurningLeft=!0:this.isTurningLeft=!1,e.engine.input.isKeyPressed(e.INPUT.KEYS.RIGHT)?this.isTurningRight=!0:this.isTurningRight=!1,e.engine.input.isKeyPressed(e.INPUT.KEYS.UP)?this.isThrusting=!0:this.isThrusting=!1,!0===this.isTurningLeft?this.avatar.vRot=-this.rotationSpeed:!0===this.isTurningRight?this.avatar.vRot=this.rotationSpeed:this.avatar.vRot=0,!0===this.isThrusting){var t=e.MATH.angleToDirectionVector(this.avatar.rotation.getAngle());t=t.normalize(),this.avatar.speed.x+=t.x*this.flightSpeed,this.avatar.speed.y+=t.y*this.flightSpeed}this.avatar.position.x>e.engine.core.size.x?(this.avatar.move(-this.avatar.size.x/4,0),this.avatar.speed.x=-this.avatar.speed.x/2):this.avatar.position.x<0&&(this.avatar.move(this.avatar.size.x/4,0),this.avatar.speed.x=-this.avatar.speed.x/2),this.avatar.position.y>e.engine.core.size.y?(this.avatar.move(0,-this.avatar.size.y/4),this.avatar.speed.y=-this.avatar.speed.y/2):this.avatar.position.y<0&&(this.avatar.move(0,this.avatar.size.y/4),this.avatar.speed.y=-this.avatar.speed.y/2)}}}])&&le(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),a}(e.Player);function ve(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ge=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.totalPoints=0,this.gameInitTime=0}var n,i;return n=t,(i=[{key:"initialize",value:function(){}},{key:"add",value:function(t){this.totalPoints+=t;var n=e.engine.scenes.getCurrentScene().gui.get("points");void 0!==n&&n.setText(e.engine.localization.get("points")+": "+this.totalPoints)}}])&&ve(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const be=new(function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=null,this.loader=null,this.player=null,this.commonBackground=null,this.points=null}var n,i;return n=t,(i=[{key:"initialize",value:function(){this.options=new o,e.engine.options.addOptions(this.options),this.commonBackground=new f,this.commonBackground.initialize(),this.loader=new ae,this.loader.initialize(),e.engine.player=new de,e.engine.player.initialize(),this.points=new ge,this.points.initialize()}},{key:"activate",value:function(){e.engine.logs.log("activate","Starting game");var t=new b;t.addBackground(this.commonBackground),t.playable=!0,t.initialize(),e.engine.scenes.addScene(t,"start_game"),(t=new oe).addBackground(this.commonBackground),t.playable=!0,t.initialize(),e.engine.scenes.addScene(t,"main_game")}},{key:"step",value:function(){}}])&&me(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),t}()),Ae=e.init("game-canvas",be)})(),i})()}));