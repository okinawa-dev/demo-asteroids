!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["demo-asteroids"]=t():e["demo-asteroids"]=t()}(self,(function(){return(()=>{var e={375:(e,t,n)=>{var i;self,e.exports=(()=>{"use strict";var o={d:(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};o.r(r),o.d(r,{Background:()=>De,Clock:()=>I,Core:()=>g,Device:()=>m,Effects:()=>R,Emitter:()=>Ie,Fonts:()=>z,GUI:()=>a,INPUT:()=>s,Item:()=>A,Localization:()=>j,Logs:()=>Ae,MATH:()=>c,Options:()=>l,Particles:()=>E,Player:()=>me,Preloader:()=>ge,Scene:()=>ce,Sounds:()=>T,Sprites:()=>_,engine:()=>be,init:()=>Be});var s={};o.r(s),o.d(s,{COMBO_TYPES:()=>v,Controller:()=>y,KEYS:()=>d,Receiver:()=>p});var a={};o.r(a),o.d(a,{ALIGN:()=>te,EVENTS:()=>ee,GuiConsole:()=>J,GuiElement:()=>B,GuiText:()=>W,ORDENATION:()=>$});var c={};o.r(c),o.d(c,{Point:()=>u,Rotation:()=>b,angleToDirectionVector:()=>ke,pointDistance:()=>we});var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.useAnimationFrame=!1,this.useSmoothParticles=!1,this.drawBoundingBoxes=!1,this.drawMaxRadius=!1,this.drawCollisionRadius=!1,this.drawOrigins=!1,this.drawCenters=!1,this.drawTrackers=!1,this.drawDirectionVectors=!1,this.showFps=!1,this.showStatistics=!1,this.showResizeMessage=!0,this.outputPressedKeys=!1,this.outputPressedCombos=!1,this.outputClicks=!1,this.debugInConsole=!1,this.debugInHtml=!1,this.debugFunctionNames=!1,this.allowPause=!0,this.allowHalt=!1,this.allowFForFps=!0,this.pauseOnWindowChange=!1,this.avoidLeavingPage=!1,this.preventDefaultKeyStrokes=!0,this.useLanguageScreen=!1,this.defaultLanguage="english",this.assetsURLPrefix=null}var t;return(t=[{key:"addOptions",value:function(e){for(var t in e)this[t]=e[t]}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=void 0===t?0:t,this.y=void 0===n?0:n}var t;return(t=[{key:"magnitude",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"normalize",value:function(){var t=this.magnitude();return new e(this.x/t,this.y/t)}},{key:"equals",value:function(t){return t instanceof e!=0&&this.x==t.x&&this.y==t.y}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();function f(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function h(){var e="";return window.location.href?window.location.href:("file:"!=window.location.protocol&&(e+=window.location.protocol+"//"),""!==window.location.host&&(e+=window.location.host+"/"),e)}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inverseKeyboard={},this.pressed={},this.lastPressed=[],this.lastPressedTime=(new Date).getTime(),this.currentInputController=null}var t;return(t=[{key:"initialize",value:function(){for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(this.inverseKeyboard[d[e]]=e);f("keyup",document,(function(e){be.input.onKeyup(e)})),f("keydown",document,(function(e){be.input.onKeydown(e),be.input.isTargetInput(e)||!0!==be.options.preventDefaultKeyStrokes&&8!=e.keyCode&&46!=e.keyCode||e.preventDefault()})),f("blur",window,(function(){be.input.resetKeys(),be.options.pauseOnWindowChange&&be.pauseGame()})),f("touchstart",be.core.canvas,(function(e){return be.input.onClickStart(e.touches[0].clientX,e.touches[0].clientY),navigator.userAgent.match(/Android/i)&&e.preventDefault(),!1})),f("touchmove",be.core.canvas,(function(e){return e.preventDefault(),!1})),f("touchend",be.core.canvas,(function(e){return e.preventDefault(),!1})),f("click",be.core.canvas,(function(e){return be.input.onClickStart(e.clientX,e.clientY),e.preventDefault(),!1})),f("mousedown",be.core.canvas,(function(e){return e.preventDefault(),!1}))}},{key:"activate",value:function(){}},{key:"getCurrentInputcontroller",value:function(){return this.currentInputController}},{key:"setCurrentInputController",value:function(e){this.currentInputController=e}},{key:"isKeyPressed",value:function(e){return this.pressed[e]}},{key:"onKeydown",value:function(e){!0!==this.pressed[e.keyCode]&&(this.pressed[e.keyCode]=!0,this.addLastPressed(e.keyCode))}},{key:"onKeyup",value:function(e){delete this.pressed[e.keyCode]}},{key:"onClickStart",value:function(e,t){if(!0!==be.device.isResizing){var n=new u(e,t),i=be.device.getGlobalScroll();n.x+=i.x,n.y+=i.y,n.x<be.device.canvasGlobalOffset.x||n.y<be.device.canvasGlobalOffset.y||n.x>be.device.canvasGlobalOffset.x+be.core.canvas.width||n.y>be.device.canvasGlobalOffset.y+be.core.canvas.height||(n.x-=be.device.canvasGlobalOffset.x,n.y-=be.device.canvasGlobalOffset.y,this.currentInputController.detectClick(n))}}},{key:"resetKeys",value:function(){for(var e in this.pressed)this.pressed[e]=!1}},{key:"addLastPressed",value:function(e){this.currentInputController.informKeyPressed(e);var t=(new Date).getTime();t-this.lastPressedTime>1e3&&(this.lastPressed=[]),this.lastPressedTime=t,this.lastPressed.push(e),this.lastPressed.length>10&&this.lastPressed.shift(),!0===be.options.outputPressedKeys&&be.logs.log("Input.addLastPressed","Pressed key: "+this.inverseKeyboard[e],t);var n=this.currentInputController.detectCombo();null!==n&&this.currentInputController.informComboPerformed(n,t)}},{key:"addClick",value:function(e){this.currentInputController.informClick(e),!0===be.options.outputClicks&&be.logs.log("Input.addClick","Click over: "+e)}},{key:"getKeyFromCode",value:function(e){return this.inverseKeyboard[e]}},{key:"convertKeyToNumber",value:function(e){switch(e){case d.NINE:return 9;case d.EIGTH:return 8;case d.SEVEN:return 7;case d.SIX:return 6;case d.FIVE:return 5;case d.FOUR:return 4;case d.THREE:return 3;case d.TWO:return 2;case d.ONE:return 1;case d.ZERO:return 0}return-1}},{key:"convertNumberToKey",value:function(e){switch(e){case 9:return d.NINE;case 8:return d.EIGTH;case 7:return d.SEVEN;case 6:return d.SIX;case 5:return d.FIVE;case 4:return d.FOUR;case 3:return d.THREE;case 2:return d.TWO;case 1:return d.ONE;case 0:return d.ZERO}return d.ZERO}},{key:"isTargetInput",value:function(e){return"textarea"==e.target.type||"text"==e.target.type||"number"==e.target.type||"email"==e.target.type||"password"==e.target.type||"search"==e.target.type||"tel"==e.target.type||"url"==e.target.type||e.target.isContentEditable}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.combos={},this.comboListeners={},this.keyListeners={},this.clickableZones={},this.clickListeners=[]}var t;return(t=[{key:"initialize",value:function(){}},{key:"activate",value:function(){be.input.setCurrentInputController(this),this.addKeyListener(be.core,"eventKeyPressed",[d.P,d.ESC,d.F],!0)}},{key:"addKeyListener",value:function(e,t,n,i){void 0===i&&(i=!1);var o={};o.listeningOb=e,o.listeningFunc=t,o.onPause=i;for(var r=0,s=n.length;r<s;r++)void 0===this.keyListeners[n[r]]?this.keyListeners[n[r]]=[o]:this.keyListeners[n[r]].push(o)}},{key:"addClickListener",value:function(e,t,n){void 0===n&&(n=!1);var i={};i.listeningOb=e,i.listeningFunc=t,i.onPause=n,this.clickListeners.push(i)}},{key:"removeListeners",value:function(e){var t,n,i,o;for(t in this.keyListeners)for(n=0,o=this.keyListeners[t].length;n<o;n++)this.keyListeners[t][n].listeningOb==e&&(this.keyListeners[t].splice(n,1),this.keyListeners[t].length||delete this.keyListeners[t]);for(t=0,i=this.clickListeners.length;t<i;t++)for(n=0,o=this.clickListeners[t].length;n<o;n++)this.clickListeners[t][n].listeningOb==e&&this.clickListeners[t].splice(n,1)}},{key:"informKeyPressed",value:function(e){var t=[];if(void 0!==this.keyListeners[e]&&(t=t.concat(this.keyListeners[e])),void 0!==this.keyListeners[d.ANY_KEY]&&(t=t.concat(this.keyListeners[d.ANY_KEY])),void 0!==t)for(var n=0,i=t.length;n<i;n++){var o=t[n];!o.onPause&&be.paused||void 0!==o.listeningOb[o.listeningFunc]&&o.listeningOb[o.listeningFunc](e)}}},{key:"informClick",value:function(e){if(void 0!==this.clickListeners)for(var t=0,n=this.clickListeners.length;t<n;t++){var i=this.clickListeners[t];!i.onPause&&be.paused||void 0!==i.listeningOb[i.listeningFunc]&&i.listeningOb[i.listeningFunc](e)}}},{key:"defineCombo",value:function(e,t,n){this.combos[e]={comboType:t,comboKeys:n,lastTime:0}}},{key:"addComboListener",value:function(e,t,n,i){void 0===i&&(i=!1);var o=[];o.listeningOb=e,o.listeningFunc=t,o.onPause=i;for(var r=0,s=n.length;r<s;r++)void 0===this.comboListeners[n[r]]?this.comboListeners[n[r]]=[o]:this.comboListeners[n[r]].push(o)}},{key:"informComboPerformed",value:function(e,t){!0===be.options.outputPressedCombos&&be.logs.log("Input.informComboPerformed","Combo activated: "+e,t),this.combos[e].lastTime=t;var n=this.comboListeners[e];if(void 0!==n)for(var i=0,o=n.length;i<o;i++){var r=n[i];!r.onPause&&be.paused||void 0!==r.listeningOb[r.listeningFunc]&&r.listeningOb[r.listeningFunc](e)}}},{key:"detectCombo",value:function(){for(var e in this.combos){var t=this.combos[e],n=void 0,i=void 0;if(t.comboType==v.SIMULTANEOUS){for(n=0,i=t.comboKeys.length;n<i&&be.input.isKeyPressed(t.comboKeys[n]);n++)if(n==i-1&&be.input.isKeyPressed(t.comboKeys[n]))return e}else if(t.comboType==v.CONSECUTIVE){var o=be.input.lastPressed.length,r=t.comboKeys.length;if(o<r)return null;for(n=1;n<=r&&n<=o&&t.comboKeys[r-n]==be.input.lastPressed[o-n];n++)if(n>=r||n>=o)return e}}return null}},{key:"addClickZone",value:function(e,t,n,i){this.clickableZones[e]={position:t,size:n,character:i}}},{key:"detectClick",value:function(e){for(var t in this.clickableZones){var n=this.clickableZones[t];e.x>=n.position.x-n.size.x/2&&e.x<=n.position.x+n.size.x/2&&e.y>=n.position.y-n.size.y/2&&e.y<=n.position.y+n.size.y/2&&(null!==n.character&&be.input.addLastPressed(n.character),be.input.addClick(t))}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}(),d={ANY_KEY:-1,INSERT:45,DELETE:46,SPACEBAR:32,ESC:27,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222,NTILDE:209},v={CONSECUTIVE:1,SIMULTANEOUS:2};var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.FRAMES_PER_SECOND=60,this.TIME_PER_FRAME=1e3/this.FRAMES_PER_SECOND,this.paused=!1,this.halted=!1,this.canvas=null,this.ctx=null,this.size=new u(500,500),this.useAnimationFrame=!1,this.timeLastRender=(new Date).getTime(),this.timeGameStart=(new Date).getTime(),this.fpsPassed=0,this.fps=this.FRAMES_PER_SECOND}var t;return(t=[{key:"initialize",value:function(e){return be.logs.log("Engine::Core.initialize","Initializing engine core object"),this.canvas=document.getElementById(e),this.size.x=this.canvas.width,this.size.y=this.canvas.height,this.timeLastRender=(new Date).getMilliseconds(),this.ctx=this.canvas.getContext&&this.canvas.getContext("2d"),this.ctx?(be.logs.log("Engine::Core.initialize","UserAgent: "+be.device.getUserAgent()),!1===be.options.useAnimationFrame||null===window.requestAnimationFrame?(this.useAnimationFrame=!1,be.logs.log("Engine::Core.initialize","NOT using requestAnimationFrame")):(this.useAnimationFrame=!0,be.logs.log("Engine::Core.initialize","Modern browser, using requestAnimationFrame")),this.loop(),1):(be.logs.log("Engine::Core.initialize","Old browser, unable to create canvas context"),alert("Unable to get canvas context. Old browser?"),null)}},{key:"activate",value:function(){be.logs.log("Engine::activate","Starting engine"),be.game.activate(),be.scenes.advanceScene()}},{key:"eventKeyPressed",value:function(e){e==d.P&&!0===be.options.allowPause?this.paused?this.unpauseGame():!1!==be.scenes.getCurrentScene().playable&&this.pauseGame():e==d.ESC&&!0===be.options.allowHalt?this.halted?(this.halted=!1,be.logs.log("Engine::eventKeyPressed","Engine un-halted"),this.timeLastRender=(new Date).getTime(),this.loop()):(this.halted=!0,be.logs.log("Engine::eventKeyPressed","Engine halted"),be.scenes.getCurrentScene().gui.get("console").addText("halt","Engine halted"),be.scenes.getCurrentScene().gui.draw(this.ctx)):e!=d.F||!0!==be.options.allowFForFps||this.paused||this.halted||(!0===be.options.showFps?be.options.showFps=!1:be.options.showFps=!0)}},{key:"loop",value:function(){var e=(new Date).getTime(),t=e-this.timeLastRender;if(t>=be.core.TIME_PER_FRAME){this.timeLastRender=e;var n=be.scenes.getCurrentScene();if(this.halted)return;n&&!0===n.isCurrent&&(!1===this.paused&&(n.step(t),void 0!==be.game&&be.game.step(t),be.effects.step(t),be.particles.step(t)),be.clock.step(t),be.player.step(t),n.draw(this.ctx),be.effects.draw(this.ctx),be.particles.draw(this.ctx),this.fpsPassed++,!0===be.options.showStatistics&&(n.getAttachedItems().length>0&&n.gui.get("console").addText("numItems",n.getAttachedItems().length+" "+be.localization.get("items")),be.effects.effects.length>0&&n.gui.get("console").addText("numEffects",be.effects.effects.length+" "+be.localization.get("effects")),be.particles.particles.length>0&&n.gui.get("console").addText("numParticles",be.particles.particles.length+" "+be.localization.get("particles")))),t=0}!0===this.useAnimationFrame?window.requestAnimationFrame((function(){be.core.loop()})):setTimeout((function(){be.core.loop()}),be.core.TIME_PER_FRAME-t)}},{key:"clearScreen",value:function(){this.ctx.clearRect(0,0,this.size.x,this.size.y)}},{key:"pauseGame",value:function(){!1!==be.options.allowPause&&(this.paused=!0,be.scenes.getCurrentScene().pauseGame())}},{key:"unpauseGame",value:function(){!1!==be.options.allowPause&&(this.paused=!1,be.scenes.getCurrentScene().unpauseGame())}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvasGlobalOffset=new u,this.isTouchDevice=!1,this.isResizing=!1,this._clearTimeOutId=null}var t;return(t=[{key:"initialize",value:function(){var e=this;this.isTouchDevice=this.detectTouchDevice(),this.isTouchDevice?be.logs.log("Engine::Initialize","Touch device detected"):be.logs.log("Engine::Initialize","Touch device NOT detected"),this.canvasGlobalOffset=be.device.getGlobalOffset(be.core.canvas),f("resize",window,(function(){be.device.isResizing=!0,!0===be.options.showResizeMessage&&be.gui.get("console").addText("resize","Resizing!"),be.device.canvasGlobalOffset=be.device.getGlobalOffset(be.core.canvas),clearTimeout(e._clearTimeOutId),e._clearTimeOutId=setTimeout(be.device.doneResizing,1e3)})),!0===be.options.avoidLeavingPage&&this.avoidLeavingPage()}},{key:"doneResizing",value:function(){be.device.isResizing=!1,!0===be.options.showResizeMessage&&be.gui.get("console").addText("resize","Resizing done")}},{key:"activate",value:function(){}},{key:"getGlobalScroll",value:function(){var e=new u(0,0);if(window.pageYOffset)e.x=window.pageXOffset,e.y=window.pageYOffset;else{var t=document.getElementsByTagName("html")[0];t.scrollTop&&(e.x=t.scrollLeft,e.y=t.scrollTop)}return e}},{key:"getGlobalOffset",value:function(e){var t=new u(0,0);for(t.x=e.offsetLeft,t.y=e.offsetTop;e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}},{key:"detectTouchDevice",value:function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}},{key:"getUserAgent",value:function(){return navigator.userAgent}},{key:"avoidLeavingPage",value:function(){window.onbeforeunload=function(){return""}}},{key:"createAndDownloadFile",value:function(e,t){if(window.navigator.msSaveOrOpenBlob){var n=new Blob([t],{type:"text/csv;charset=utf-8;"});window.navigator.msSaveOrOpenBlob(n,e)}else{var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download",e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}},{key:"detectIE",value:function(){var e=navigator.userAgent.toLowerCase();return/msie/.test(e)?parseFloat((e.match(/.*(?:rv|ie)[/: ](.+?)([ );]|$)/)||[])[1]):navigator.appVersion.indexOf("Trident/")>0?11:-1}},{key:"isIE",value:function(){return-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var b=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.angle=0,this.a=1,this.b=0,this.c=0,this.d=1}var t;return(t=[{key:"getAngle",value:function(){return this.angle}},{key:"rotate",value:function(e){this.update(this.angle+e)}},{key:"update",value:function(e){this.angle=e,this.a=Math.cos(this.angle),this.b=-Math.sin(this.angle),this.c=Math.sin(this.angle),this.d=Math.cos(this.angle)}},{key:"transformPosition",value:function(e){return new u(e.x*this.a+e.y*this.b,e.x*this.c+e.y*this.d)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var A=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.spriteName=null,this._visible=!0,this.position=new u,this.size=new u,this.scaling=new u(1,1),this.speed=new u,this.maxVel=0,this.accel=0,this.vRot=0,this.maxVRot=0,this.accelRot=0,this.rotation=new b,this.globalAlpha=1,this.maxRadius=0,this.collisionRadius=0,this.isAnimated=!1,this.currentFrame=0,this.numLoops=1,this.forceFrameSpeed=0,this.timeLastFrame=0,this._attachedItems=[],this._removedItems=[],this._parent=null}var t;return(t=[{key:"initialize",value:function(){}},{key:"activate",value:function(){for(var e=0,t=this._attachedItems.length;e<t;e++)this._attachedItems[e].activate()}},{key:"getVisible",value:function(){return this._visible}},{key:"setVisible",value:function(e){this._visible=e}},{key:"getParent",value:function(){return this._parent}},{key:"setParent",value:function(e){this._parent=e}},{key:"getParentScene",value:function(){for(var e=this;null!==e.getParent();)e=e.getParent();return e===this?be.scenes.getCurrentScene():e}},{key:"getAttachedItems",value:function(){return this._attachedItems}},{key:"attachItem",value:function(e){this._attachedItems.push(e),e.setParent(this)}},{key:"detachItem",value:function(e){var t=this.getParentScene();t.input.removeListeners(e);for(var n=e.children(),i=0,o=n.length;i<o;i++)t.input.removeListeners(n[i]);this._removedItems.push(e),e.setParent(null)}},{key:"detachAllItems",value:function(){for(var e=0,t=this._attachedItems.length;e<t;e++){var n=this._attachedItems[e];n.detachAllItems(),this.detachItem(n)}this._finalizeRemoved()}},{key:"children",value:function(){for(var e=[],t=0,n=this._attachedItems.length;t<n;t++)e=(e=e.concat(this._attachedItems[t])).concat(this._attachedItems[t].children());return e}},{key:"_resetItems",value:function(){this._attachedItems.length=0}},{key:"_resetRemoved",value:function(){this._removedItems.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this._removedItems.length;e<t;e++){var n=this._removedItems[e],i=this._attachedItems.indexOf(n);-1!=i&&this._attachedItems.splice(i,1)}this._resetRemoved()}},{key:"setImage",value:function(e){this.spriteName=e,this.size=be.sprites.getSpriteSize(e)}},{key:"getOrigin",value:function(){var e=this.getPosition();return new u(e.x-this.size.x/2,e.y-this.size.y/2)}},{key:"getPosition",value:function(){var e=new u,t=new u,n=new u;return null!==this._parent?(t=this._parent.getPosition(),n=this._parent.rotation.transformPosition(this.position),e.x=n.x+t.x,e.y=n.y+t.y):(e.x=this.position.x,e.y=this.position.y),e}},{key:"setPosition",value:function(e,t){this.position.x=e,this.position.y=t}},{key:"getSize",value:function(){return this.size}},{key:"setSize",value:function(e,t){this.size.x=e,this.size.y=t}},{key:"getScaling",value:function(){return this.scaling}},{key:"setScaling",value:function(e,t){this.scaling.x=e,this.scaling.y=t}},{key:"getSpeed",value:function(){return this.speed}},{key:"setSpeed",value:function(e,t){this.speed.x=e,this.speed.y=t}},{key:"getParentPosition",value:function(){return null!==this._parent?this._parent.getPosition():new u}},{key:"getParentSpeed",value:function(){return null!==this._parent?this._parent.getSpeed():new u}},{key:"getRadius",value:function(){return Math.sqrt(Math.pow(this.size.x/2,2)+Math.pow(this.size.y/2,2))}},{key:"getMagnitude",value:function(){return Math.sqrt(this.speed.x*this.speed.x+this.speed.y*this.speed.y)}},{key:"move",value:function(e,t){this.position.x+=e,this.position.y+=t}},{key:"rotate",value:function(e){this.rotation.rotate(e)}},{key:"setRotation",value:function(e){this.rotation.update(e)}},{key:"getRotation",value:function(){return null!==this._parent?this.rotation.getAngle()+this._parent.getRotation():this.rotation.getAngle()}},{key:"draw",value:function(e){if(!0===this._visible){for(var t=0,n=this._attachedItems.length;t<n;t++)this._attachedItems[t].draw(e);null!==this.spriteName&&be.sprites.draw(e,this),!0===be.options.drawBoundingBoxes&&this.drawHelper(e,"spriteBox"),!0===be.options.drawMaxRadius&&this.drawHelper(e,"maxRadius"),!0===be.options.drawCollisionRadius&&this.drawHelper(e,"collisionRadius"),!0===be.options.drawOrigins&&this.drawHelper(e,"origin"),!0===be.options.drawCenters&&this.drawHelper(e,"center"),!0===be.options.drawDirectionVectors&&this.drawHelper(e,"direction")}}},{key:"step",value:function(e){0===this.speed.x&&0===this.speed.y||this.move(this.speed.x*e/be.core.TIME_PER_FRAME,this.speed.y*e/be.core.TIME_PER_FRAME),0!==this.vRot&&this.rotate(this.vRot*e/be.core.TIME_PER_FRAME),!0===this.isAnimated&&null!==this.spriteName&&be.sprites.step(e,this);for(var t=0,n=this._attachedItems.length;t<n;t++)this._attachedItems[t].step(e);this._finalizeRemoved()}},{key:"eventAnimationRestart",value:function(){}},{key:"drawHelper",value:function(e,t){var n=this.getPosition(),i=this.getSize(),o=this.getScaling();if("maxRadius"==t)e.beginPath(),e.arc(n.x,n.y,this.maxRadius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=1,e.strokeStyle="#FF0000",e.stroke();else if("collisionRadius"==t)e.beginPath(),e.arc(n.x,n.y,this.collisionRadius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=1,e.strokeStyle="#FF0000",e.stroke();else if("origin"==t)e.fillStyle="#FF0000",e.fillRect(n.x-i.x/2*o.x,n.y-i.y/2*o.y,2,2);else if("center"==t)e.fillStyle="#FF0000",e.fillRect(n.x,n.y,2,2);else if("spriteBox"==t)e.lineWidth=1,e.strokeStyle="#FF0000",e.strokeRect(n.x-i.x/2*o.x,n.y-i.y/2*o.y,i.x*o.x,i.y*o.y);else if("direction"==t){var r=this.getSpeed();e.lineWidth=1,e.strokeStyle="#FF0000",e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(n.x+10*r.x,n.y+10*r.y),e.stroke()}}},{key:"collide",value:function(){return this.detachAllItems(),!0}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=S(n);if(i){var o=S(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return O(this,e)});function r(e,t,n,i,s){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),a=o.call(this);var c=be.sprites.sprites[e];return a.size=new u(c[3],c[4]),a.numFrames=c[5],a.position=new u(t,n),a.speed=new u(i,s),a.lived=0,a.lifeTime=0,a.maxLoops=1,a.spriteName=e,a.initialScaling=1,a.finalScaling=1,a.transparencyMethod=0,a.globalAlpha=1,a}return(t=[{key:"step",value:function(e){k(S(r.prototype),"step",this).call(this,e),this.lived++;var t=1;1==this.initialScaling&&1==this.finalScaling||(t=this.initialScaling+(this.finalScaling-this.initialScaling)*this.lived/this.lifeTime,this.scaling.x=t,this.scaling.y=t),2==this.transparencyMethod?0!==this.lifeTime?this.globalAlpha=1-this.lived/this.lifeTime:this.globalAlpha=1-this.currentFrame/this.numFrames:1==this.transparencyMethod&&(0!==this.lifeTime?this.globalAlpha=this.lived/this.lifeTime:this.globalAlpha=this.currentFrame/this.numFrames),!0===this.isAnimated&&be.sprites.step(e,this)}},{key:"draw",value:function(e){k(S(r.prototype),"draw",this).call(this,e)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(r.prototype,t),r}(A);var R=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.effects=[],this.removed=[]}var t;return(t=[{key:"initialize",value:function(){this.effects.length=0}},{key:"removeEffect",value:function(e){this.removed.push(e)}},{key:"_resetRemoved",value:function(){this.removed.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this.removed.length;e<t;e++){var n=this.effects.indexOf(this.removed[e]);-1!=n&&this.effects.splice(n,1)}}},{key:"step",value:function(e){this._resetRemoved();for(var t=0,n=this.effects.length;t<n;t++){var i=this.effects[t];i.step(e),i.lifeTime>0&&i.lived>i.lifeTime&&this.removeEffect(i),i.maxLoops>0&&i.numLoops>i.maxLoops&&this.removeEffect(i)}this._finalizeRemoved()}},{key:"draw",value:function(e){for(var t=0,n=this.effects.length;t<n;t++)this.effects[t].draw(e)}},{key:"addEffect",value:function(e,t,n,i,o){var r=new P(e,t,n,i,o);return this.effects.push(r),r}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.particles=[],this.maxParticles=1e4,this._removedParticles=[],this.effectField=document.createElement("canvas"),this.effectField.width=be.core.size.x,this.effectField.height=be.core.size.y,this.effectField.ctx=this.effectField.getContext("2d")}var t;return(t=[{key:"initialize",value:function(){this.particles=[],this.maxParticles=1e4,this._removedParticles=[]}},{key:"addParticle",value:function(e){this.particles.length>this.maxParticles||this.particles.push(e)}},{key:"removeParticle",value:function(e){this._removedParticles.push(e)}},{key:"_resetItems",value:function(){this.particles.length=0}},{key:"_resetRemoved",value:function(){this._removedParticles.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this._removedParticles.length;e<t;e++){var n=this._removedParticles[e],i=this.particles.indexOf(n);-1!=i&&this.particles.splice(i,1)}}},{key:"step",value:function(e){var t,n,i=this.particles.length;for(t=0;t<i;t++)(n=this.particles[t]).lived>n.ttl?this.removeParticle(n):n.step(e);this._finalizeRemoved()}},{key:"draw",value:function(e){if(this.particles.length>0){this.effectField.ctx.clearRect(0,0,be.core.size.x,be.core.size.y);for(var t,n=-1;t=this.particles[++n];){var i=[t.color[0]-3*t.lived,t.color[1]-t.lived,t.color[2],t.color[3]];this.effectField.ctx.fillStyle="rgba("+i.join(",")+")",this.effectField.ctx.fillRect(t.position.x,t.position.y,t.size,t.size)}e.drawImage(this.effectField,0,0,be.core.size.x,be.core.size.y)}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sprites={},this.images={}}var t;return(t=[{key:"initialize",value:function(){this.sprites.length=0,this.images.length=0}},{key:"step",value:function(e,t){var n=this.sprites[t.spriteName][7],i=this.sprites[t.spriteName][5],o=this.sprites[t.spriteName][6];if(0!==t.forceFrameSpeed&&(n=t.forceFrameSpeed),i>1){var r=(new Date).getTime();if(0===t.timeLastFrame&&(t.timeLastFrame=r),r-t.timeLastFrame>1e3/n){var s=t.currentFrame;t.currentFrame++,t.currentFrame>=o+i&&(t.currentFrame=o),t.timeLastFrame=r,s==i-1&&(t.numLoops+=1,void 0!==t.eventAnimationRestart&&t.eventAnimationRestart())}}}},{key:"draw",value:function(e,t){if(!1!==t.getVisible()){var n=this.sprites[t.spriteName][0],i=this.sprites[t.spriteName][1],o=this.sprites[t.spriteName][2],r=this.sprites[t.spriteName][3],s=this.sprites[t.spriteName][4],a=t.getPosition();e.globalAlpha=t.globalAlpha,0!==t.rotation.getAngle()?(e.save(),e.translate(a.x,a.y),e.rotate(t.rotation.getAngle()),e.drawImage(this.images[n],i+t.currentFrame*r,o,r,s,-r/2*t.scaling.x,-s/2*t.scaling.y,r*t.scaling.x,s*t.scaling.y),e.restore()):e.drawImage(this.images[n],i+t.currentFrame*r,o,r,s,a.x-r/2*t.scaling.x,a.y-s/2*t.scaling.y,r*t.scaling.x,s*t.scaling.y),e.globalAlpha=1}}},{key:"imageExists",value:function(e){return Object.prototype.hasOwnProperty.call(this.images,e)}},{key:"spriteExists",value:function(e){return Object.prototype.hasOwnProperty.call(this.sprites,e)}},{key:"addImage",value:function(e,t){this.images[e]=t}},{key:"addSprite",value:function(e,t,n,i,o,r,s,a,c){this.sprites[e]=[t,n,i,o,r,s,a,c]}},{key:"getImage",value:function(e){return this.images[this.sprites[e][0]]}},{key:"getImageFromPath",value:function(e){return this.images[e]}},{key:"getSpriteData",value:function(e){var t=this.sprites[e];return void 0!==t?t:null}},{key:"getSpriteInfo",value:function(e,t){var n=this.sprites[e];if(void 0!==n){var i=n[t];if(void 0!==i)return i}return null}},{key:"getSpriteSize",value:function(e){var t=this.sprites[e],n=0,i=0;return void 0!==t&&(n=t[3],i=t[4]),new u(n,i)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var T=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sounds={}}var t;return(t=[{key:"initialize",value:function(){this.sounds.length=0}},{key:"step",value:function(){}},{key:"soundExists",value:function(e){for(var t=Object.keys(this.sounds),n=0,i=t.length;n<i;n++)if(this.sounds[t[n]][1]==e)return!0;return!1}},{key:"addSound",value:function(e,t,n){this.sounds[e]=[n,t]}},{key:"get",value:function(e){if(void 0===this.sounds[e])return null;var t=this.sounds[e][0];return t.currentTime>0&&(t=t.cloneNode()),t}},{key:"play",value:function(e){var t=this.get(e);null!==t&&(t.currentTime>0&&(t.currentTime=0),t.play())}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fonts={}}var t;return(t=[{key:"initialize",value:function(){this.fonts.length=0}},{key:"step",value:function(){}},{key:"fontExists",value:function(e){for(var t=Object.keys(this.fonts),n=0,i=t.length;n<i;n++)if(this.fonts[t[n]][1]==e)return!0;return!1}},{key:"addFont",value:function(e,t,n){this.fonts[e]=[n,t]}},{key:"get",value:function(e){return void 0===this.fonts[e]?null:this.fonts[e][0]}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var C=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collection=null,this.currentSceneIndex=null,this.currentSceneName=null,this.currentScene=null}var t;return(t=[{key:"initialize",value:function(){this.collection=[],this.currentSceneIndex=0,this.currentSceneName="",this.currentScene=null}},{key:"activate",value:function(){}},{key:"draw",value:function(){}},{key:"step",value:function(){}},{key:"getCurrentScene",value:function(){return this.currentScene}},{key:"setScene",value:function(e){void 0!==this.currentScene&&null!==this.currentScene&&(this.currentScene.isCurrent=!1),be.core.clearScreen(),this.currentSceneIndex=e,this.currentSceneName=be.scenes.collection[e].name,this.currentScene=be.scenes.collection[e].scene,this.currentScene.isCurrent=!0,this.currentScene.activate(),void 0!==be.player&&null!==be.player&&be.player.activate(),be.logs.log("Scenes::setScene","Set Scene: "+this.currentSceneName+" ("+this.currentSceneIndex+")"),be.external("SCENE_CHANGE",null,null)}},{key:"addScene",value:function(e,t){be.logs.log("Scenes::addScene","Add Scene: "+t),e.isCurrent=!1,this.collection.push({scene:e,name:t})}},{key:"insertScene",value:function(e,t,n){e.isCurrent=!1,this.collection.splice(n,0,{scene:e,name:t})}},{key:"advanceScene",value:function(){be.scenes.currentSceneIndex+1>=be.scenes.collection.length||be.scenes.setScene(be.scenes.currentSceneIndex+1)}},{key:"goBackScene",value:function(){this.currentSceneIndex-1<0||this.setScene(this.currentSceneIndex-1)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.startTime=0,this.passedTime=0,this.ticker500=0,this.listeners500={},this.ticker1=0,this.listeners1={},this.ticker5=0,this.listeners5={}}var t;return(t=[{key:"initialize",value:function(){this.startTime=(new Date).getTime()}},{key:"activate",value:function(){}},{key:"step",value:function(e){this.ticker1+=e,this.ticker5+=e,this.ticker500+=e,this.ticker1>=1e3&&(this.informListeners(this.listeners1),this.ticker1=0),this.ticker5>=5e3&&(this.informListeners(this.listeners5),this.ticker5=0),this.ticker500>=500&&(this.informListeners(this.listeners500),this.ticker500=0)}},{key:"draw",value:function(){}},{key:"suscribe500",value:function(e,t){this.listeners500[e]=t}},{key:"suscribeOneSecond",value:function(e,t){this.listeners1[e]=t}},{key:"suscribeFiveSeconds",value:function(e,t){this.listeners5[e]=t}},{key:"informListeners",value:function(e){for(var t in e)e[t]()}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fallbackLanguage="english",this.selectedLanguage="",this.stringTables={},this.baseTexts={english:{paused:"Paused, press P to continue",loaded:"Loading",items:"items",effects:"effects",particles:"particles",choose_language:"Choose language",english:"English",spanish:"Spanish"},spanish:{paused:"Pausa, pulsa P para continuar",loaded:"Cargando",items:"elementos",effects:"efectos",particles:"partículas",choose_language:"Escoge el idioma",english:"English",spanish:"Español"}}}var t;return(t=[{key:"initialize",value:function(){for(var e in this.selectedLanguage="english",this.baseTexts)this.stringTables[e]=[],this.addTextsToStringTable(e,this.baseTexts[e])}},{key:"get",value:function(e){var t=this.stringTables[this.selectedLanguage][e];return void 0!==t?t:this.stringTables[this.fallbackLanguage][e]}},{key:"addStringTable",value:function(e,t){this.stringTables[e]=t}},{key:"setBaseTexts",value:function(e){this.baseTexts=e}},{key:"addTextsToStringTable",value:function(e,t){for(var n in t)this.stringTables[e][n]=t[n]}},{key:"selectLanguage",value:function(e){this.selectedLanguage=e}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t,n){return(L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t){if(t&&("object"===F(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(n);if(i){var o=D(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return N(this,e)});function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=o.call(this,e)).guiId=null,void 0!==e?t.setParent(e):t.guiId="globalGUI",t.inputCallbacks={},t.guiElements={},t.blink=!1,t}return(t=[{key:"initialize",value:function(){L(D(r.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){L(D(r.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){L(D(r.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){L(D(r.prototype),"step",this).call(this,e)}},{key:"setBlink",value:function(e){var t=this.getParentScene();null!==t&&(!0===e?(this.blink=!0,t.clock.suscribe(this.guiId+"_clock",this,"blinkStep",350)):(this.blink=!1,this.setVisible(!0),t.clock.unsuscribe(this.guiId+"_clock")))}},{key:"blinkStep",value:function(){!0===this.blink&&!0===this.getVisible()?this.setVisible(!1):(!0===this.blink&&!1===this.getVisible()||!1===this.blink)&&this.setVisible(!0)}},{key:"addInputCallback",value:function(e,t){var n=this.getParentScene();null!==n&&(n.input.addKeyListener(this,"eventKeyPressed",[e],!0),this.inputCallbacks[e]=t)}},{key:"eventKeyPressed",value:function(e){void 0!==this.inputCallbacks[e]&&this.inputCallbacks[e]()}},{key:"getElement",value:function(e){var t=this.guiElements[e];return void 0!==t?t:null}},{key:"get",value:function(e){return this.getElement(e)}},{key:"attachItem",value:function(e,t){this.guiElements[t]=e,e.guiId=t,L(D(r.prototype),"attachItem",this).call(this,e)}},{key:"detachItem",value:function(e){void 0!==e&&(L(D(r.prototype),"detachItem",this).call(this,this.get(e)),delete this.guiElements[e])}},{key:"detachAllItems",value:function(){for(var e=Object.keys(this.guiElements),t=0,n=e.length;t<n;t++)this.guiElements[e[t]].detachAllItems(),this.detachItem(e[t]);this.guiElements={},this._finalizeRemoved()}},{key:"_resetItems",value:function(){this.attachedItems.length=0,this.guiElements={}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(r.prototype,t),r}(A);function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t,n){return(U="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=V(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function H(e,t){if(t&&("object"===K(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=V(n);if(i){var o=V(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return H(this,e)});function r(e,t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=o.call(this)).text=e,i.font='base,BaseFont,"Courier New"',i.fontSize=20,i.fontColor="#FFFFFF",i.fontBorderColor="#000000",i.textAlign=te.LEFT,i.verticalOffset=20,i.horizontalOffset=10,void 0===t||void 0===n?(i.size.x=100,i.size.y=30):(i.size.x=t,i.size.y=n),i._canvasRendering=!0,i._innerCanvas=document.createElement("canvas"),i._innerCanvas.width=i.size.x,i._innerCanvas.height=i.size.y,i._innerContext=i._innerCanvas.getContext("2d"),i._innerChange=!0,i}return(t=[{key:"initialize",value:function(){U(V(r.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){U(V(r.prototype),"activate",this).call(this)}},{key:"setSize",value:function(e,t){U(V(r.prototype),"setSize",this).call(this,e,t),this._innerCanvas.width=this.size.x,this._innerCanvas.height=this.size.y,this._innerChange=!0}},{key:"setText",value:function(e){this.text!=e&&(this.text=e,this._innerChange=!0)}},{key:"getText",value:function(){return this.text}},{key:"_updateInnerRender",value:function(e){var t=new u(this.horizontalOffset,this.verticalOffset);this.textAlign==te.CENTER?t.x=this.size.x/2:this.textAlign==te.RIGHT&&(t.x=this.size.x-this.horizontalOffset),this._innerContext.lineWidth=e.lineWidth,this._innerContext.clearRect(0,0,this.size.x,this.size.y),this._innerContext.strokeStyle=this.fontBorderColor,this._innerContext.fillStyle=this.fontColor,this._innerContext.textAlign=this.textAlign,this._innerContext.font="bold "+this.fontSize+"px "+this.font;for(var n=this.getText().split("\n"),i=0,o=n.length;i<o;i++)this._innerContext.strokeText(n[i],t.x,t.y),this._innerContext.fillText(n[i],t.x,t.y),t.y+=this.verticalOffset;this._innerChange=!1}},{key:"draw",value:function(e){if(!0===this.getVisible()){var t=this.getPosition(),n=this.getSize();if(!1===this._canvasRendering){var i=new u(this.horizontalOffset,this.verticalOffset);this.textAlign==te.CENTER?i.x=this.size.x/2:this.textAlign==te.RIGHT&&(i.x=this.size.x-this.horizontalOffset),e.strokeStyle=this.fontBorderColor,e.fillStyle=this.fontColor,e.textAlign=this.textAlign,e.font="bold "+this.fontSize+"px "+this.font;for(var o=this.getText().split("\n"),s=0,a=o.length;s<a;s++)e.strokeText(o[s],t.x-n.x/2+i.x,t.y-n.y/2+i.y),e.fillText(o[s],t.x-n.x/2+i.x,t.y-n.y/2+i.y),i.y+=this.verticalOffset}else!0===this._innerChange&&this._updateInnerRender(e),e.drawImage(this._innerCanvas,t.x-this.size.x/2,t.y-this.size.y/2)}U(V(r.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){U(V(r.prototype),"step",this).call(this,e)}},{key:"setFont",value:function(e){this.font=e}},{key:"setFontSize",value:function(e){this.fontSize=e}},{key:"setFontColor",value:function(e){this.fontColor=e}},{key:"setFontBorderColor",value:function(e){this.fontBorderColor=e}},{key:"setAlign",value:function(e){this.textAlign=e}},{key:"setCanvasRendering",value:function(e){this._canvasRendering=e}},{key:"setVerticalOffset",value:function(e){this.verticalOffset=e}},{key:"setHorizontalOffset",value:function(e){this.horizontalOffset=e}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(r.prototype,t),r}(B);function Y(e){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t,n){return(q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Z(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e,t){if(t&&("object"===Y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var J=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Z(n);if(i){var o=Z(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return X(this,e)});function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(e=o.call(this))._texts={},e._textKeys=[],e._textsToRemove=[],e.order=$.DOWN,e}return(t=[{key:"initialize",value:function(){q(Z(r.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){q(Z(r.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){q(Z(r.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){var t=this._textKeys.length;if(0!==t){for(var n=0,i=(new Date).getTime(),o=0;o<t;o++){var s=this._texts[this._textKeys[o]],a=s[1];s[2]+2e3<i?this._textsToRemove.push(this._textKeys[o]):(a.setPosition(0,n),this.order==$.DOWN?n+=20:n-=20)}if(q(Z(r.prototype),"step",this).call(this,e),(t=this._textsToRemove.length)>0){for(var c=0;c<t;c++)this.detachItem(this._textsToRemove[c]),delete this._texts[this._textsToRemove[c]];this._textKeys=Object.keys(this._texts),this._textsToRemove=[]}}}},{key:"addText",value:function(e,t){if(void 0!==this._texts[e])this._texts[e][0]!=t&&(this._texts[e][0]=t,this._texts[e][1].setText(t)),this._texts[e][2]=(new Date).getTime();else{var n=new W(t,this.size.x,this.size.y);n.setSize(this.size.x,this.size.y),this._texts[e]=[t,n,(new Date).getTime()],this._textKeys=Object.keys(this._texts),this.attachItem(n,e)}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(r.prototype,t),r}(B),$={UP:0,DOWN:1},ee={SELECTION:0},te={LEFT:"left",RIGHT:"right",CENTER:"center"};function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t,n){return(ie="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ae(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function re(e,t){if(t&&("object"===ne(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return se(e)}function se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ce=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ae(n);if(i){var o=ae(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return re(this,e)});function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(e=o.call(this)).playable=!1,e.backgrounds=[],e.isCurrent=!1,e.gui=new B(se(e)),e.clock=new I,e.input=new y,e}return(t=[{key:"initialize",value:function(){var e=this;ie(ae(r.prototype),"initialize",this).call(this);var t=new J;t.setSize(170,30),t.setPosition(15+t.size.x/2,15+t.size.y/2),t.order=$.DOWN,this.gui.initialize(),this.gui.attachItem(t,"console"),this.clock.initialize(),be.clock.suscribeOneSecond("FPS",(function(){be.options.showFps&&e.gui.get("console").addText("fps",be.core.fpsPassed+" fps"),be.core.fpsPassed=0})),this.input.initialize()}},{key:"activate",value:function(){ie(ae(r.prototype),"activate",this).call(this),this.gui.activate(),this.clock.activate(),this.input.activate();for(var e=0,t=this.backgrounds.length;e<t;e++)this.backgrounds[e].activate()}},{key:"draw",value:function(e){e.clearRect(0,0,be.core.size.x,be.core.size.y);for(var t=0,n=this.backgrounds.length;t<n;t++)this.backgrounds[t].draw(e);ie(ae(r.prototype),"draw",this).call(this,e),this.gui.draw(e)}},{key:"step",value:function(e){for(var t=0,n=this.backgrounds.length;t<n;t++)this.backgrounds[t].step(e);this.clock.step(e),ie(ae(r.prototype),"step",this).call(this,e),this.gui.step(e)}},{key:"addBackground",value:function(e){this.backgrounds.push(e)}},{key:"pauseGame",value:function(){if(null===this.gui.get("pause")){var e=new W(be.localization.get("paused"),500,30);e.setFontColor("#FF2222"),e.setAlign(te.CENTER),e.setPosition(be.core.size.x/2,be.core.size.y/2+100),this.gui.attachItem(e,"pause")}}},{key:"unpauseGame",value:function(){this.gui.detachItem("pause")}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(r.prototype,t),r}(A);function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}if(!Object.defineProperty)throw"Font.js requires Object.defineProperty, which this browser does not support.";if(!document.createElement("canvas").getContext)throw"Font.js requires <canvas> and the Canvas2D API, which this browser does not support.";function ue(){this.fontFamily="fjs"+(999999*Math.random()|0)}!function(e){try{return void new Uint8Array(1)}catch(e){}function t(e,t){return this.slice(e,t)}function n(e,t){var n,i=e.length;for(arguments.length<2&&(t=0),n=0;n<i;++n,++t)this[t]=255&e[n]}function i(e){var i,o;if("number"==typeof e)for(i=new Array(e),o=0;o<e;++o)i[o]=0;else i=e.slice(0);return i.subarray=t,i.buffer=i,i.byteLength=i.length,i.set=n,"object"===le(e)&&e.buffer&&(i.buffer=e.buffer),i}e.Uint8Array=i,e.Uint32Array=i,e.Int32Array=i}(window),function(e){var t;e.opera||"response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype||(t=e.VBArray?function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}:function(){this.responseBody},Object.defineProperty(XMLHttpRequest.prototype,"response",{get:t}))}(window),window.btoa||(window.btoa=function(e){var t,n,i,o,r,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,c=0,l="",u=[];if(!e)return e;do{t=(r=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,n=r>>12&63,i=r>>6&63,o=63&r,u[c++]=s.charAt(t)+s.charAt(n)+s.charAt(i)+s.charAt(o)}while(a<e.length);l=u.join("");var f=e.length%3;return(f?l.slice(0,f-3):l)+"===".slice(f||3)}),ue.prototype.url="",ue.prototype.format="",ue.prototype.data="",ue.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==",ue.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400},ue.prototype.systemfont=!1,ue.prototype.loaded=!1,ue.prototype.onload=function(){},ue.prototype.onerror=function(){},ue.prototype.canvas=!1,ue.prototype.context=!1,ue.prototype.validate=function(e,t,n,i,o){!1!==o&&o<0?this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed)."):getComputedStyle(e,null).getPropertyValue("width").replace("px","")>0?(document.head.removeChild(t),document.body.removeChild(e),this.loaded=!0,this.onload()):(console.log("timing out"),setTimeout((function(){i.validate(e,t,n,i,!1!==o&&o-50)}),1e3))},ue.prototype.ondownloaded=function(){var e=this,t=function(e){return String.fromCharCode(e)},n=function(e){if(e<256)return t(0)+t(e);var n=255&e;return t(e>>8)+t(n)},i=function(e,t){return 256*e+t},o=function(e,t){var n,i=e>>7==1;return n=256*(e&=127)+t,i?n-32768:n},r=function(e,t,n,i){return 16777216*e+65536*t+256*n+i},s=function(t){e.onerror(t)},a=t(0)+t(1)+t(0)+t(0),c=this.data,l=t(c[0])+t(c[1])+t(c[2])+t(c[3]),u=l===a,f=!u&&"OTTO"===l;if(u)this.format="truetype";else{if(!f)return void s("Error: file at "+this.url+" cannot be interpreted as OpenType font.");this.format="opentype"}var h,p,y=i(c[4],c[5]),d=12+16*y,v={};for(h=12;h<d;h+=16)p=t(c[h])+t(c[h+1])+t(c[h+2])+t(c[h+3]),v[p]={name:p,checksum:r(c[h+4],c[h+5],c[h+6],c[h+7]),offset:r(c[h+8],c[h+9],c[h+10],c[h+11]),length:r(c[h+12],c[h+13],c[h+14],c[h+15])};var g=function(e){return v[e]?e:(s("Error: font is missing the required OpenType '"+e+"' table."),!1)};if(!1!==(p=g("head"))){h=v[p].offset,v[p].version=""+c[h]+c[h+1]+c[h+2]+c[h+3];var m=i(c[h+18],c[h+19]);if(this.metrics.quadsize=m,!1!==(p=g("hhea"))&&(h=v[p].offset,v[p].version=""+c[h]+c[h+1]+c[h+2]+c[h+3],this.metrics.ascent=o(c[h+4],c[h+5])/m,this.metrics.descent=o(c[h+6],c[h+7])/m,this.metrics.leading=o(c[h+8],c[h+9])/m,!1!==(p=g("OS/2"))&&(h=v[p].offset,v[p].version=""+c[h]+c[h+1],this.metrics.weightclass=i(c[h+4],c[h+5]),!1!==(p=g("cmap"))))){h=v[p].offset,v[p].version=""+c[h]+c[h+1],y=i(c[h+2],c[h+3]);for(var b,A,w,k,x=!1,O=0;O<y;O++)A=i(c[b=h+4+8*O],c[b+1]),w=i(c[b+2],c[b+3]),k=r(c[b+4],c[b+5],c[b+6],c[b+7]),3===A&&1===w&&(x=k);var S="A";if(!1!==x&&4===(l=i(c[h+=x],c[h+1]))){for(var P=function(e){return-1===[9,10,11,12,13,32,127,128,129,141,142,143,144,149,157,158,160,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8232,8233,8234,8235,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,12288].indexOf(e)},R=h+14,E=h+14+i(c[h+6],c[h+7])/2*2,_=!1;R<E&&!P(_=i(c[R],c[R+1]));R+=2)_=!1;if(0!=_){S=String.fromCharCode(_);var T=(65536-(_-1))%65536,z=t(0)+n(_)+n(65535)+n(0)+n(_)+n(65535)+n(T)+n(1),C=btoa(z);this.base64=this.base64.substring(0,380)+C+this.base64.substring(380+C.length)}}this.bootstrapValidation(S,!1)}}},ue.prototype.bootstrapValidation=function(e,t){var n=this.fontFamily+" testfont",i=document.createElement("style");i.setAttribute("type","text/css"),i.innerHTML="@font-face {\n  font-family: '"+n+"';\n  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n       format('truetype');}",document.head.appendChild(i);var o=!1;this.systemfont||(o=this.toStyleNode(),document.head.appendChild(o));var r=document.createElement("p");if(r.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;",r.style.fontFamily="'"+this.fontFamily+"', '"+n+"'",r.innerHTML=e+e+e+e+e+e+e+e+e+e,document.body.appendChild(r),"undefined"==typeof getComputedStyle)this.onload(),error("Error: getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.");else{var s=this.systemfont?1e3:this.metrics.quadsize,a=document.createElement("canvas");a.width=s,a.height=s,this.canvas=a;var c=a.getContext("2d");c.font="1em '"+this.fontFamily+"'",c.fillStyle="white",c.fillRect(-1,-1,s+2,s+2),c.fillStyle="black",c.fillText("test text",50,s/2),this.context=c;var l=this;setTimeout((function(){l.validate(r,i,o,l,t)}),50)}},ue.prototype.processSystemFont=function(){this.systemfont=!0,this.metrics=!1,this.bootstrapValidation("A",1e3)},ue.prototype.loadFont=function(){var e=this;if(-1!==this.url.indexOf(".")){var t=new XMLHttpRequest;t.open("GET",e.url,!0),t.responseType="arraybuffer",t.onload=function(n){var i=t.response;i?(e.data=new Uint8Array(i),e.ondownloaded()):e.onerror("Error downloading font resource from "+e.url)},t.onerror=function(t){e.onerror("Error downloading font resource from "+e.url)},t.send(null)}else setTimeout((function(){e.processSystemFont()}),10)},ue.prototype.styleNode=!1,ue.prototype.toStyleNode=function(){if(this.styleNode)return this.styleNode;this.styleNode=document.createElement("style"),this.styleNode.type="text/css",this.url.replace(".ttf",".eot");var e="@font-face {\n";return e+="  font-family: '"+this.fontFamily+"';\n",e+="  src: url('"+this.url+"') format('"+this.format+"');\n",e+="}",this.styleNode.innerHTML=e,this.styleNode},ue.prototype.measureText=function(e,t){if(!this.loaded)return this.onerror("measureText() was called while the font was not yet loaded"),!1;this.context.font=t+"px '"+this.fontFamily+"'";var n=this.context.measureText(e);n.fontsize=t,n.ascent=0,n.descent=0,n.bounds={minx:0,maxx:n.width,miny:0,maxy:0},n.height=0;var i=[];n.width,this.metrics.quadsize,i.push(e);var o,r=i.length;for(o=0;o<r;o++)this.measureSegment(i[o],t,n);return n},ue.prototype.measureSegment=function(e,t,n){var i=document.createElement("div");for(i.style.position="absolute",i.style.opacity=0,i.style.font=t+"px '"+this.fontFamily+"'",i.innerHTML=e,g=1;g<10;g++)i.innerHTML+="<br/>"+e;document.body.appendChild(i),n.leading=1.2*t;var o,r=(o=i,document.defaultView.getComputedStyle(o,null).getPropertyValue("height"));if((r=r.replace("px",""))>=10*t&&(n.leading=r/10|0),document.body.removeChild(i),/^\s*$/.test(e))return n;this.canvas;var s=this.context,a=this.systemfont?1e3:this.metrics.quadsize,c=a,l=a,u=a/2,f=(a-n.width)/2;f!==(0|f)&&(f|=0),s.fillStyle="white",s.fillRect(-50,-50,c+100,l+100),s.fillStyle="black",s.fillText(e,f,u);for(var h=n.width+50|0,p=4*t,y=f-25,d=u-p/2,v=s.getImageData(y,d,h,p).data,g=0,m=0,b=4*h,A=v.length,w=p/2;++g<A&&255===v[g];);var k=g/b|0;for(g=A-1;--g>0&&255===v[g];);var x=g/b|0;for(g=0,m=0;m<h&&255===v[g];)(g+=b)>=A&&(m++,g=g-A+4);var O=m,S=1;for(g=A-3,m=0;m<h&&255===v[g];)(g-=b)<0&&(m++,g=A-3-4*S++);var P=h-m;return n.ascent=w-k,n.descent=x-w,n.bounds={minx:O-25,maxx:P-25,miny:-n.descent,maxy:n.ascent},n.height=x-k+1,n},Object.defineProperty(ue.prototype,"src",{set:function(e){this.url=e,this.loadFont()}}),void 0===(i=function(){return ue}.call(t,n,t,e))||(e.exports=i);const fe=ue;function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t,n){return(pe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ve(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function de(e,t){if(t&&("object"===he(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ve(e){return(ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ge=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ve(n);if(i){var o=ve(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return de(this,e)});function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(e=o.call(this)).timeStarted=0,e.percentageLoaded=0,e.incremental=0,e.imageAssets=[],e.totalImages=0,e.soundAssets=[],e.totalFonts=0,e.message=null,e}return(t=[{key:"initialize",value:function(){pe(ve(r.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){var e,t,n;for(be.logs.log("Preloader::activate","Loading assets"),pe(ve(r.prototype),"activate",this).call(this),this.timeStarted=(new Date).getTime(),e=0,t=this.imageAssets.length;e<t;e++)n=this.imageAssets[e],this.addImageToLoad(n);for(e=0,t=this.soundAssets.length;e<t;e++)n=this.soundAssets[e],this.addSoundToLoad(n);this.message=new W(be.localization.get("loaded")+" "+this.percentageLoaded+"%",300,30),this.message.setPosition(be.core.size.x/2,be.core.size.y/2+100),this.message.setAlign(te.CENTER),this.message.setVerticalOffset(20),this.message.setFontColor("#FF2222"),this.gui.attachItem(this.message,"msg_loading")}},{key:"addAnimation",value:function(e){this.imageAssets.push(e)}},{key:"addSprite",value:function(e){e.xStart=0,e.yStart=0,e.frames=1,e.initFrame=0,e.speed=0,this.addAnimation(e)}},{key:"addImageToLoad",value:function(e){var t=null;be.sprites.imageExists(e.path)||(f("load",t=new Image,(function(){be.preloader.incrementalLoader()})),null!==be.options.assetsURLPrefix?t.src=be.options.assetsURLPrefix+e.path:t.src=h()+e.path,this.totalImages++,be.sprites.addImage(e.path,t)),be.sprites.spriteExists(e.name)||be.sprites.addSprite(e.name,e.path,e.xStart,e.yStart,e.width,e.height,e.frames,e.initFrame,e.speed)}},{key:"addSound",value:function(e){this.soundAssets.push(e)}},{key:"addSoundToLoad",value:function(e){var t=null;if(!be.sounds.soundExists(e.path)){var n=e.path;n=null!==be.options.assetsURLPrefix?be.options.assetsURLPrefix+n:h()+n,(t=new Audio(n)).load(),f("canplaythrough",t,(function(){be.preloader.incrementalLoader("sound")})),be.sounds.addSound(e.name,e.path,t)}}},{key:"addFont",value:function(e){var t=new fe;this.totalFonts++,t.onerror=function(e){be.logs.log("Preloader::addFont","Error loading a font: "+e)},t.onload=function(){be.logs.log("Preloader::addFont","Font loaded <"+t.fontFamily+">"),be.preloader.incrementalLoader("font")},t.fontFamily=e.name,void 0!==e.flag?t.src=e.path:null!==be.options.assetsURLPrefix?t.src=be.options.assetsURLPrefix+e.path:t.src=h()+e.path,be.fonts.addFont(e.name,e.path,t)}},{key:"incrementalLoader",value:function(){var e=this.totalImages+this.soundAssets.length+this.totalFonts;this.incremental+=1,this.percentageLoaded=Math.floor(100*this.incremental/e)}},{key:"draw",value:function(e){pe(ve(r.prototype),"draw",this).call(this,e);var t=be.core.size.x/3;e.fillStyle="#FF2222",e.fillRect((be.core.size.x-t)/2+1,be.core.size.y/2+51,this.percentageLoaded*t/100,15),e.lineWidth=2,e.strokeStyle="#FFEEEE",e.strokeRect((be.core.size.x-t)/2,be.core.size.y/2+50,t+2,16)}},{key:"step",value:function(e){pe(ve(r.prototype),"step",this).call(this,e),this.message.setText(be.localization.get("loaded")+" "+this.percentageLoaded+"%");var t=(new Date).getTime()-this.timeStarted;this.percentageLoaded>=100&&t>1e3&&(be.core.activate(),be.external("LOADED",null,null))}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(r.prototype,t),r}(ce);var me=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),be.logs.log("Player::initialize","Initializing player object"),this.avatar=null}var t;return(t=[{key:"getAvatar",value:function(){return this.avatar}},{key:"setAvatar",value:function(e){this.avatar=e}},{key:"initialize",value:function(){}},{key:"activate",value:function(){}},{key:"step",value:function(){}},{key:"draw",value:function(){}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();const be=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=null,this.logs=null,this.core=null,this.device=null,this.effects=null,this.particles=null,this.sprites=null,this.sounds=null,this.fonts=null,this.clock=null,this.localization=null,this.input=null,this.controls=null,this.scenes=null,this.preloader=null,this.game=null,this.externalCallback=null,this.player=null}var t;return(t=[{key:"initialize",value:function(e,t,n){this.options=new l,this.logs=new Ae,this.core=new g,this.device=new m,this.effects=new R,this.particles=new E,this.sprites=new _,this.sounds=new T,this.fonts=new z,this.clock=new I,this.localization=new j,this.input=new p,this.scenes=new C,this.preloader=new ge,this.player=new me,this.logs.log("Engine::initialize","Initializing starts..."),this.game=t,void 0!==n&&(this.externalCallback=n),this.core.initialize(e),this.device.initialize(),this.effects.initialize(),this.particles.initialize(),this.sprites.initialize(),this.sounds.initialize(),this.clock.initialize(),this.input.initialize(),this.localization.initialize(),this.scenes.initialize(),this.preloader.playable=!1,this.preloader.initialize(),this.game.initialize()}},{key:"external",value:function(e,t,n){var i=this;"undefined"!=typeof externalCallback&&setTimeout((function(){try{i.externalCallback(e,t,n)}catch(n){i.logs.log("Engine::external","Error with external callback with event "+e+" "+t)}}),1)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}());var Ae=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"log",value:function(e,t,n){var i=[];if(!1!==be.options.debugInConsole)if(!0===be.options.debugFunctionNames&&i.push(e),Array.isArray(t)?i.push(t.join(" ")):i.push(t),n&&i.push(n),!0===be.options.debugInHtml&&void 0!==be.core.canvas){var o=document.createElement("div");o.innerHTML=i,be.core.canvas.parentNode.appendChild(o)}else void 0===window.console||void 0===window.console.log||window.console.log(i)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();function we(e,t){return void 0===t.x||void 0===t.y||void 0===e.x||void 0===e.y?-1:Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function ke(e){var t=new u;return t.x=Math.cos(e),t.y=Math.sin(e),t}function xe(e){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Se(e,t){if(t&&("object"===xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Pe(n);if(i){var o=Pe(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return Se(this,e)});function r(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(n=o.call(this)).setPosition(e.x,e.y),n.setSpeed(t.x,t.y),n.ttl=-1,n.lived=0,n.color=[],n.size=2,n}return(t=[{key:"initialize",value:function(){}},{key:"activate",value:function(){}},{key:"step",value:function(e){this.move(this.speed.x*e/be.core.TIME_PER_FRAME,this.speed.y*e/be.core.TIME_PER_FRAME),this.lived++}},{key:"draw",value:function(){}},{key:"collide",value:function(){return!1}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(r.prototype,t),r}(A);function Ee(e){return(Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _e(e,t,n){return(_e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ce(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ze(e,t){if(t&&("object"===Ee(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Te(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ce(n);if(i){var o=Ce(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return ze(this,e)});function r(e,t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=o.call(this)).size=new u(10,10),i.particleSpeed=e,i.magnitude=t,i.particleColor=[255,255,255,255],i.particleLife=100,i.particleSize=3,i.started=!1,i.spread=n,i.emissionRate=3,i}return(t=[{key:"start",value:function(){this.started=!0}},{key:"stop",value:function(){this.started=!1}},{key:"createParticle",value:function(){var e=Math.random()*this.spread-this.spread/2,t=ke(this.getRotation()+e);t=t.normalize();var n=new u(t.x*this.particleSpeed,t.y*this.particleSpeed),i=this.getPosition(),o=new Re(i,n);o.ttl=Math.random()*this.particleLife,o.color=this.particleColor,o.size=this.particleSize,be.particles.addParticle(o)}},{key:"step",value:function(e){if(_e(Ce(r.prototype),"step",this).call(this,e),!0===this.started)for(var t=0;t<this.emissionRate;t++)this.createParticle()}},{key:"draw",value:function(e){_e(Ce(r.prototype),"draw",this).call(this,e)}},{key:"collide",value:function(){return!1}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(r.prototype,t),r}(A);function je(e){return(je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fe(e,t,n){return(Fe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ne(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Le(e,t){return(Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Me(e,t){if(t&&("object"===je(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var De=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Le(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ne(n);if(i){var o=Ne(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return Me(this,e)});function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(e=o.call(this)).backgroundType="image",e.color="black",e.spriteName=null,e.position.x=be.core.size.x/2,e.position.y=be.core.size.y/2,e.pauseScroll=!1,e.verticalScroll=!1,e.verticalOffset=0,e.verticalSpeed=0,e.horizontalScroll=!1,e.horizontalOffset=0,e.horizontalSpeed=0,e}return(t=[{key:"initialize",value:function(){Fe(Ne(r.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){Fe(Ne(r.prototype),"activate",this).call(this),this.verticalOffset=0,this.horizontalOffset=0}},{key:"step",value:function(e){Fe(Ne(r.prototype),"step",this).call(this,e),!1===this.pauseScroll&&(!0===this.verticalScroll?(this.verticalOffset+=this.verticalSpeed*e/be.core.TIME_PER_FRAME,this.verticalOffset=Math.floor(this.verticalOffset%be.core.size.y)):!0===this.horizontalScroll&&(this.horizontalOffset+=this.horizontalSpeed*e/be.core.TIME_PER_FRAME,this.horizontalOffset=Math.floor(this.horizontalOffset%be.core.size.x)))}},{key:"draw",value:function(e){if("color"==this.backgroundType)e.fillStyle=this.color,e.fillRect(0,0,be.core.size.x,be.core.size.y);else if("image"==this.backgroundType){var t,n;!0===this.verticalScroll?(t=Math.floor(this.verticalOffset),n=be.core.size.y-t,t>0&&e.drawImage(be.sprites.getImage(this.spriteName),0,n,be.core.size.x,t,0,0,be.core.size.x,t),n>0&&e.drawImage(be.sprites.getImage(this.spriteName),0,0,be.core.size.x,n,0,t,be.core.size.x,n)):!0===this.horizontalScroll?(t=Math.floor(this.horizontalOffset),n=be.core.size.x-t,t>0&&e.drawImage(be.sprites.getImage(this.spriteName),0,0,t,be.core.size.y,n,0,t,be.core.size.y),n>0&&e.drawImage(be.sprites.getImage(this.spriteName),t,0,n,be.core.size.y,0,0,n,be.core.size.y)):be.sprites.draw(e,this)}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(r.prototype,t),r}(A);function Be(e,t,n){return"complete"===document.readyState?be.initialize(e,t,n):f("load",window,(function(){be.initialize(e,t,n)})),be}return r})()}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";n.r(i),n.d(i,{default:()=>fe});var e=n(375),t=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultLanguage="english",this.debugInConsole=!0,this.meteorPeriodicity=500,this.shotPeriodicity=200};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(f,t);var n,i,o,l,u=(o=f,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=c(o);if(l){var n=c(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return a(this,e)});function f(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(e=u.call(this)).BACKGROUND_SPEED=8,e.BACKGROUND_STARS=30,e.speeds=[],e.offsets=[],e.parallaxDisplacement=5,e.starfields=[],e}return n=f,(i=[{key:"initialize",value:function(){for(var t=0;t<3;t++){this.starfields[t]=document.createElement("canvas"),this.starfields[t].layer=t,this.starfields[t].width=e.engine.core.size.x+(t+1)*this.parallaxDisplacement,this.starfields[t].height=e.engine.core.size.y,this.starfields[t].ctx=this.starfields[t].getContext("2d"),this.speeds[t]=this.BACKGROUND_SPEED+7*(t+1),this.offsets[t]=0,0===t&&(this.starfields[t].ctx.fillStyle="#000",this.starfields[t].ctx.fillRect(0,0,this.starfields[t].width,this.starfields[t].height)),this.starfields[t].ctx.fillStyle="#FFF",this.starfields[t].ctx.globalAlpha=2*(t+1)/10;for(var n=0;n<this.BACKGROUND_STARS;n++)this.starfields[t].ctx.fillRect(Math.floor(Math.random()*this.starfields[t].width),Math.floor(Math.random()*this.starfields[t].height),t+1,t+1)}}},{key:"step",value:function(e){for(var t=0;t<3;t++)this.offsets[t]+=this.speeds[t]/e,this.offsets[t]=this.offsets[t]%this.starfields[t].height}},{key:"draw",value:function(t){for(var n=0;n<3;n++){var i=Math.floor(this.offsets[n]),o=this.starfields[n].height-i,r=this.starfields[n].width,s=void 0;if(void 0===e.engine.player||null===e.engine.player||e.engine.currentScene<=2)s=(n+1)*this.parallaxDisplacement*(e.engine.core.size.x/2)/e.engine.core.size.x;else{var a=e.engine.player.getAvatar().getPosition().x;(s=Math.round((n+1)*this.parallaxDisplacement*a/e.engine.core.size.x))<0?s=0:s+e.engine.core.size.x>r&&(s=r-e.engine.core.size.x)}i>0&&t.drawImage(this.starfields[n],0+s,o,e.engine.core.size.x,i,0,0,e.engine.core.size.x,i),o>0&&t.drawImage(this.starfields[n],0+s,0,e.engine.core.size.x,o,0,i,e.engine.core.size.x,o)}}}])&&r(n.prototype,i),f}(e.Background);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(a,t);var n,i,o,r,s=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(o);if(r){var n=d(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),s.call(this)}return n=a,(i=[{key:"initialize",value:function(){h(d(a.prototype),"initialize",this).call(this),this.input.addKeyListener(this,"eventKeyPressed",[e.INPUT.KEYS.SPACEBAR])}},{key:"activate",value:function(){var t=e.engine.player.getAvatar();t.setPosition(e.engine.core.size.x/2,e.engine.core.size.y/2),this.attachItem(t),h(d(a.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){h(d(a.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){h(d(a.prototype),"step",this).call(this,e)}},{key:"eventKeyPressed",value:function(t){t==e.INPUT.KEYS.SPACEBAR&&e.engine.scenes.advanceScene()}}])&&f(n.prototype,i),a}(e.Scene);function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function b(e,t,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t){if(t&&("object"===g(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var x=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(a,t);var n,i,o,r,s=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(o);if(r){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return w(this,e)});function a(t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(i=s.call(this)).spriteName="meteor",i.size.x=e.engine.sprites.sprites[i.spriteName][3],i.size.y=e.engine.sprites.sprites[i.spriteName][4],i.linearSpeed=n,i.vRot=Math.PI/600,i.scaling.x=t,i.scaling.y=t,i.maxRadius=i.getRadius(),i.collisionRadius=29,i}return n=a,(i=[{key:"step",value:function(e){b(k(a.prototype),"step",this).call(this,e)}},{key:"draw",value:function(e){b(k(a.prototype),"draw",this).call(this,e)}},{key:"collide",value:function(t){b(k(a.prototype),"collide",this).call(this);var n=t.speed.x,i=t.speed.y;t instanceof T&&(n=t.speed.x/10,i=t.speed.y/10);var o=e.engine.effects.addEffect("halo",this.position.x,this.position.y,this.speed.x+n,this.speed.y+i);o.initialScaling=2,o.finalScaling=3,o.lifeTime=20,o.vRot=Math.PI/100,o.transparencyMethod=2;for(var r=0;r<10;r++)(o=e.engine.effects.addEffect("explosion",this.position.x+40*(Math.random()-.5),this.position.y+40*(Math.random()-.5),this.speed.x+(Math.random()-.5),this.speed.y+(Math.random()-.5))).scaling.x=Math.abs(Math.random()-.1),o.scaling.y=o.scaling.x,o.vRot=(Math.random()-.5)*Math.PI/50,o.lifeTime=100,o.isAnimated=!0,o.transparencyMethod=Math.floor(3*Math.random());return e.engine.sounds.play("explosion"),!0}}])&&m(n.prototype,i),a}(e.Item);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function P(e,t,n){return(P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t){if(t&&("object"===O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var T=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(a,t);var n,i,o,r,s=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(o);if(r){var n=_(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return E(this,e)});function a(t,n,i){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(o=s.call(this)).spriteName="shot",o.creator=t,o.size.x=e.engine.sprites.sprites[o.spriteName][3],o.size.y=e.engine.sprites.sprites[o.spriteName][4],o.position=n,o.speedMagnitude=5,o.setRotation(i);var r=e.MATH.angleToDirectionVector(i);return r=r.normalize(),o.speed.x=r.x*o.speedMagnitude,o.speed.y=r.y*o.speedMagnitude,o.maxRadius=o.getRadius(),o.collisionRadius=12,o}return n=a,(i=[{key:"step",value:function(e){P(_(a.prototype),"step",this).call(this,e)}},{key:"draw",value:function(e){P(_(a.prototype),"draw",this).call(this,e)}},{key:"collide",value:function(t){return!(t instanceof a||t==this.creator||(t instanceof x&&e.engine.game.points.add(50),P(_(a.prototype),"collide",this).call(this),0))}}])&&S(n.prototype,i),a}(e.Item);function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function I(e,t,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=L(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e,t){if(t&&("object"===z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var M=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(a,t);var n,i,o,r,s=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=L(o);if(r){var n=L(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return F(this,e)});function a(){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=s.call(this)).size=new e.MATH.Point(10,10),t}return n=a,(i=[{key:"step",value:function(e){I(L(a.prototype),"step",this).call(this,e)}},{key:"draw",value:function(e){I(L(a.prototype),"draw",this).call(this,e)}},{key:"shoot",value:function(t){var n=new T(t,this.getPosition(),this.getRotation());e.engine.scenes.getCurrentScene().attachItem(n)}},{key:"collide",value:function(){return!1}}])&&C(n.prototype,i),a}(e.Item);function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function B(e,t,n){return(B="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=G(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function U(e,t){if(t&&("object"===N(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var H=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(a,t);var n,i,o,r,s=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=G(o);if(r){var n=G(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return U(this,e)});function a(t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this)).spriteName=t,n.size.x=e.engine.sprites.sprites[n.spriteName][3],n.size.y=e.engine.sprites.sprites[n.spriteName][4],n.maxRadius=n.getRadius(),n.collisionRadius=24,n.gunRack=[],n.motorEffect=null,n}return n=a,(i=[{key:"initialize",value:function(){B(G(a.prototype),"initialize",this).call(this),this.motorEffect=new e.Emitter(1,1,Math.PI/5),this.motorEffect.setPosition(-20,-1),this.motorEffect.setRotation(Math.PI),this.attachItem(this.motorEffect);var t=new M;t.setPosition(20,0),this.gunRack.push(t),this.attachItem(t),this.setRotation(-Math.PI/2)}},{key:"step",value:function(t){B(G(a.prototype),"step",this).call(this,t),!0===e.engine.player.isThrusting?this.motorEffect.start():this.motorEffect.stop()}},{key:"draw",value:function(e){B(G(a.prototype),"draw",this).call(this,e)}},{key:"collide",value:function(t){return t instanceof T&&t.creator==this||(this.speed.x=this.speed.x/10,this.speed.y=this.speed.y/10,e.engine.game.points.add(-10)),!1}},{key:"shoot",value:function(){for(var t=0,n=this.gunRack.length;t<n;t++)this.gunRack[t].shoot(this);e.engine.sounds.play("shot")}}])&&D(n.prototype,i),a}(e.Item);function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Y(e,t,n){return(Y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=X(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e,t){if(t&&("object"===V(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Z=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(a,t);var n,i,o,r,s=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=X(o);if(r){var n=X(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Q(this,e)});function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=s.call(this)).timeLastMeteor=0,e}return n=a,(i=[{key:"initialize",value:function(){Y(X(a.prototype),"initialize",this).call(this);var t=new e.GUI.GuiText;t.setSize(250,30),t.setPosition(15+t.size.x/2,e.engine.core.size.y-15-t.size.y/2),t.setText(e.engine.localization.get("points")+": 0"),this.gui.attachItem(t,"points")}},{key:"activate",value:function(){this.attachItem(e.engine.player.getAvatar()),Y(X(a.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){Y(X(a.prototype),"draw",this).call(this,e)}},{key:"step",value:function(t){Y(X(a.prototype),"step",this).call(this,t),this.checkBoundaries(),this.checkCollisions();var n=(new Date).getTime();if(n-this.timeLastMeteor>e.engine.options.meteorPeriodicity){this.timeLastMeteor=n;var i=new x(1,1.5),o=Math.floor(4*Math.random()),r=Math.random()*Math.PI;switch(o){case 0:i.position.x=Math.random()*e.engine.core.size.x,i.position.y=1-i.size.y;break;case 1:i.position.x=1-i.size.x,i.position.y=Math.random()*e.engine.core.size.y,r+=Math.PI/2;break;case 2:i.position.x=Math.random()*e.engine.core.size.x,i.position.y=e.engine.core.size.y+i.size.y-1,r-=Math.PI;break;default:case 3:i.position.x=e.engine.core.size.x+i.size.x-1,i.position.y=Math.random()*e.engine.core.size.y,r-=Math.PI/2}var s=e.MATH.angleToDirectionVector(r);s=s.normalize(),i.speed.x=s.x*i.linearSpeed,i.speed.y=s.y*i.linearSpeed,this.attachItem(i)}}},{key:"checkBoundaries",value:function(){var t;this._resetRemoved();for(var n=0;n<this.getAttachedItems().length;n++)((t=this.getAttachedItems()[n]).position.x>e.engine.core.size.x+t.size.x||t.position.x<0-t.size.x||t.position.y<0-t.size.y||t.position.y>e.engine.core.size.y+t.size.y)&&this.detachItem(t);this._finalizeRemoved()}},{key:"checkCollisions",value:function(){var t,n;this._resetRemoved();for(var i=0;i<this.getAttachedItems().length;i++)if(0!==(t=this.getAttachedItems()[i]).collisionRadius)for(var o=i+1;o<this.getAttachedItems().length;o++)0!==(n=this.getAttachedItems()[o]).collisionRadius&&(Math.abs(t.position.x-n.position.x)>t.size.x/2+n.size.x/2||Math.abs(t.position.y-n.position.y)>t.size.y/2+n.size.y/2||e.MATH.pointDistance(t.position,n.position)<=t.collisionRadius+n.collisionRadius&&(!0===t.collide(n)&&this.detachItem(t),!0===n.collide(t)&&this.detachItem(n)));this._finalizeRemoved()}}])&&W(n.prototype,i),a}(e.Scene);function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var $=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}var n,i;return n=t,(i=[{key:"initialize",value:function(){e.engine.preloader.addSprite({name:"starship",path:"assets/images/ship.png",width:50,height:50}),e.engine.preloader.addSprite({name:"meteor",path:"assets/images/meteor.png",width:60,height:60}),e.engine.preloader.addSprite({name:"shot",path:"assets/images/shot.png",width:10,height:10}),e.engine.preloader.addAnimation({name:"explosion",path:"assets/images/effect.explosion.png",xStart:0,yStart:0,width:48,height:47,frames:11,initFrame:0,speed:14}),e.engine.preloader.addSprite({name:"halo",path:"assets/images/effect.halo.png",width:63,height:63}),e.engine.preloader.addSound({name:"explosion",path:"assets/sounds/fridobeck_explosion.mp3"}),e.engine.preloader.addSound({name:"shot",path:"assets/sounds/halgrimm_shot.mp3"}),e.engine.preloader.addFont({name:"baseFont",path:"assets/fonts/visitor1.ttf"}),e.engine.preloader.addBackground(e.engine.game.commonBackground),e.engine.preloader.initialize(),e.engine.scenes.addScene(e.engine.preloader,"preloader"),e.engine.scenes.setScene(0),e.engine.localization.addTextsToStringTable("english",this.localization_en()),e.engine.localization.addTextsToStringTable("spanish",this.localization_es()),e.engine.localization.selectLanguage(e.engine.game.options.defaultLanguage)}},{key:"localization_en",value:function(){return{game_name:"Game",press_spacebar:"Press the spacebar to start",touch_screen:"Touch the screen to continue",points:"Points",accumulated:"Accumulated points",totals:"Total points"}}},{key:"localization_es",value:function(){return{game_name:"Juego",press_spacebar:"Pulsa espacio para comenzar",touch_screen:"Toca la pantalla para continuar",points:"Puntos",accumulated:"Puntos acumulados",totals:"Puntos totales"}}}])&&J(n.prototype,i),t}();function ee(e){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ne(e,t,n){return(ne="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=re(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oe(e,t){if(t&&("object"===ee(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var se=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(a,t);var n,i,o,r,s=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=re(o);if(r){var n=re(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return oe(this,e)});function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=s.call(this)).avatar=null,e.timeLastShot=0,e.isTurningLeft=!1,e.isTurningRight=!1,e.isThrusting=!1,e.rotationSpeed=Math.PI/50,e.flightSpeed=.05,e}return n=a,(i=[{key:"initialize",value:function(){ne(re(a.prototype),"initialize",this).call(),this.avatar=new H("starship"),this.avatar.initialize()}},{key:"activate",value:function(){ne(re(a.prototype),"activate",this).call(),this.timeLastShot=0,this.isTurningLeft=!1,this.isTurningRight=!1,this.isThrusting=!1,this.getAvatar().getParentScene().input.addKeyListener(this,"eventKeyPressed",[e.INPUT.KEYS.SPACEBAR])}},{key:"eventKeyPressed",value:function(t){if(!0!==e.engine.core.paused&&t==e.INPUT.KEYS.SPACEBAR){var n=(new Date).getTime();n-this.timeLastShot>e.engine.options.shotPeriodicity&&(this.avatar.shoot(),this.timeLastShot=n)}}},{key:"step",value:function(){if(void 0===this.getAvatar().getParentScene()||null===this.getAvatar().getParentScene()||!1!==this.getAvatar().getParentScene().playable){if(e.engine.input.isKeyPressed(e.INPUT.KEYS.LEFT)?this.isTurningLeft=!0:this.isTurningLeft=!1,e.engine.input.isKeyPressed(e.INPUT.KEYS.RIGHT)?this.isTurningRight=!0:this.isTurningRight=!1,e.engine.input.isKeyPressed(e.INPUT.KEYS.UP)?this.isThrusting=!0:this.isThrusting=!1,!0===this.isTurningLeft?this.avatar.vRot=-this.rotationSpeed:!0===this.isTurningRight?this.avatar.vRot=this.rotationSpeed:this.avatar.vRot=0,!0===this.isThrusting){var t=e.MATH.angleToDirectionVector(this.avatar.rotation.getAngle());t=t.normalize(),this.avatar.speed.x+=t.x*this.flightSpeed,this.avatar.speed.y+=t.y*this.flightSpeed}this.avatar.position.x>e.engine.core.size.x?(this.avatar.move(-this.avatar.size.x/4,0),this.avatar.speed.x=-this.avatar.speed.x/2):this.avatar.position.x<0&&(this.avatar.move(this.avatar.size.x/4,0),this.avatar.speed.x=-this.avatar.speed.x/2),this.avatar.position.y>e.engine.core.size.y?(this.avatar.move(0,-this.avatar.size.y/4),this.avatar.speed.y=-this.avatar.speed.y/2):this.avatar.position.y<0&&(this.avatar.move(0,this.avatar.size.y/4),this.avatar.speed.y=-this.avatar.speed.y/2)}}}])&&te(n.prototype,i),a}(e.Player);function ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ce=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.totalPoints=0,this.gameInitTime=0}var n,i;return n=t,(i=[{key:"initialize",value:function(){}},{key:"add",value:function(t){this.totalPoints+=t;var n=e.engine.scenes.getCurrentScene().gui.get("points");void 0!==n&&n.setText(e.engine.localization.get("points")+": "+this.totalPoints)}}])&&ae(n.prototype,i),t}();function le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const ue=new(function(){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.options=null,this.loader=null,this.player=null,this.commonBackground=null,this.points=null}var i,o;return i=n,(o=[{key:"initialize",value:function(){this.options=new t,e.engine.options.addOptions(this.options),this.commonBackground=new l,this.commonBackground.initialize(),this.loader=new $,this.loader.initialize(),e.engine.player=new se,e.engine.player.initialize(),this.points=new ce,this.points.initialize()}},{key:"activate",value:function(){e.engine.logs.log("activate","Starting game");var t=new v;t.addBackground(this.commonBackground),t.playable=!0,t.initialize(),e.engine.scenes.addScene(t,"start_game"),(t=new Z).addBackground(this.commonBackground),t.playable=!0,t.initialize(),e.engine.scenes.addScene(t,"main_game")}},{key:"step",value:function(){}}])&&le(i.prototype,o),n}()),fe=e.init("game-canvas",ue)})(),i})()}));